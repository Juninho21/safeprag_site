import{r as e,j as t,D as a,C as n,a as s,P as i,b as o,R as r,T as d,c as l,d as c,B as m,e as g,f as p,g as u}from"./vendor-react-DXGt926u.js";import{t as h,c as x,a as b,h as v}from"./vendor-CzUK4DuD.js";import{v as f,p as y,f as N}from"./vendor-utils-BcyCYpIF.js";const w={COMPANY:"safeprag_company_data",CLIENTS:"safeprag_clients",PRODUCTS:"safeprag_products",SCHEDULES:"safeprag_schedules",SETTINGS:"safeprag_settings",SERVICE_ORDERS:"safeprag_service_orders",SIGNATURES:{TECHNICIAN:"userData",CLIENT:"client_signature_data",SUPERVISOR:"supervisor_assinatura"}},j=()=>{const e={};return Object.entries(w).forEach((([t,a])=>{if("string"==typeof a){const s=localStorage.getItem(a);if(s)try{e[t]=JSON.parse(s)}catch(n){e[t]=s}}else"object"==typeof a&&(e[t]={},Object.entries(a).forEach((([a,s])=>{const i=localStorage.getItem(s);if(i)try{e[t][a]=JSON.parse(i)}catch(n){e[t][a]=i}})))})),e},S=e=>{Object.entries(e).forEach((([e,t])=>{const a=w[e];"string"==typeof a?localStorage.setItem(a,JSON.stringify(t)):"object"==typeof a&&"object"==typeof t&&Object.entries(t).forEach((([e,t])=>{const n=a[e];n&&localStorage.setItem(n,JSON.stringify(t))}))}))},C=()=>{I();const e=localStorage.getItem(w.SERVICE_ORDERS);if(!e)return!1;const t=JSON.parse(e),a=(new Date).toISOString().split("T")[0];return t.filter((e=>e.date===a&&"in_progress"===e.status)).length>0},D=e=>{try{const t=localStorage.getItem(w.SERVICE_ORDERS);if(!t)return!1;const a=JSON.parse(t);return a.some((t=>t.scheduleId===e&&"in_progress"===t.status))}catch(t){return!1}},O=()=>{try{const e=_();e&&e.total>4&&L();const t=localStorage.getItem(w.SERVICE_ORDERS);if(!t)return[];const a=JSON.parse(t);if(a.length>100){const e=a.sort(((e,t)=>new Date(t.createdAt).getTime()-new Date(e.createdAt).getTime())).slice(0,100);return localStorage.setItem(w.SERVICE_ORDERS,JSON.stringify(e)),e}return a}catch(e){return[]}},$=e=>{try{const t=localStorage.getItem("userData");if(!t)throw new Error("Dados do controlador não encontrados. Por favor, verifique a aba assinaturas.");const a=JSON.parse(t).name;if(!a)throw new Error("Nome do controlador não encontrado. Por favor, verifique a aba assinaturas.");const n={id:e.id,scheduleId:e.id,clientId:e.clientId,clientName:e.clientName,clientBranch:e.clientBranch||e.clientName,clientAddress:e.clientAddress||"",serviceType:e.serviceType||"",date:e.date,startTime:e.startTime||"",serviceStartTime:"",endTime:"",status:"in_progress",createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString(),notes:"",controladorName:a,signatures:{client:"",technician:""},product:void 0};return R(n),n}catch(t){throw t}},E=(e,t)=>{try{const a=(new Date).toISOString(),n={id:f(),scheduleId:e.id,clientId:e.clientId,clientName:e.clientName,clientAddress:e.clientAddress,startTime:"",endTime:"",date:e.date,status:"cancelled",noServiceReason:t,createdAt:a,updatedAt:a},s=O();return s.push(n),localStorage.setItem(w.SERVICE_ORDERS,JSON.stringify(s)),T(e.id,"cancelled"),n}catch(a){throw new Error("Erro ao registrar não atendimento")}},I=()=>{try{const e=localStorage.getItem(w.SERVICE_ORDERS);if(!e)return;const t=JSON.parse(e),a=new Date,n=t.filter((e=>{const t=new Date(e.createdAt),n=(a.getTime()-t.getTime())/864e5<=30;return n}));localStorage.setItem(w.SERVICE_ORDERS,JSON.stringify(n))}catch(e){}},A=async()=>{try{localStorage.removeItem(w.SERVICE_ORDERS),localStorage.removeItem(w.COMPANY),localStorage.removeItem(w.CLIENTS),localStorage.removeItem(w.PRODUCTS),localStorage.removeItem("userData");const e=new CustomEvent("systemCleanup");return window.dispatchEvent(e),!0}catch(e){throw new Error("Falha ao limpar dados do sistema")}},T=(e,t)=>{const a=localStorage.getItem(w.SCHEDULES);if(a)try{const n=JSON.parse(a),s=n.findIndex((t=>t.id===e));if(-1===s)return;const i={...n[s],status:t,updatedAt:(new Date).toISOString()};n[s]=i,localStorage.setItem(w.SCHEDULES,JSON.stringify(n));const o=new CustomEvent("scheduleUpdate",{detail:{scheduleId:e,status:t,schedule:i,timestamp:(new Date).toISOString()}});window.dispatchEvent(o);const r=new StorageEvent("storage",{key:w.SCHEDULES,newValue:JSON.stringify(n),url:window.location.href});window.dispatchEvent(r)}catch(n){throw n}},R=e=>{try{if(!e.controladorName){const t=localStorage.getItem("userData");if(!t)throw new Error("Dados do controlador não encontrados. Por favor, verifique a aba assinaturas.");const a=JSON.parse(t).name;if(!a)throw new Error("Nome do controlador não encontrado. Por favor, verifique a aba assinaturas.");e.controladorName=a}const t=localStorage.getItem(w.SERVICE_ORDERS);let a=t?JSON.parse(t):[];const n=a.findIndex((t=>t.id===e.id));-1!==n?a[n]=e:a.push(e),localStorage.setItem(w.SERVICE_ORDERS,JSON.stringify(a))}catch(t){throw t}},_=()=>{let e=0;for(let t in localStorage)localStorage.hasOwnProperty(t)&&(e+=2*localStorage[t].length/1024/1024);return{total:e}},L=()=>{const{total:e}=_();if(e>8){const e=O(),t=new Date;t.setDate(t.getDate()-90);const a=e.filter((e=>new Date(e.createdAt)>=t));localStorage.setItem(w.SERVICE_ORDERS,JSON.stringify(a));for(let n in localStorage)!localStorage.hasOwnProperty(n)||n.includes("SERVICE_ORDERS")||n.includes("userData")||n.includes("companyData")||localStorage.removeItem(n)}};function P(...e){return h(x(e))}const k=b("inline-flex items-center justify-center rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-transparent shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline",warning:"bg-orange-500 text-white hover:bg-orange-600",success:"bg-green-500 text-white hover:bg-green-600"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),z=e.forwardRef((({className:e,variant:a,size:n,asChild:s=!1,...i},o)=>t.jsx("button",{className:P(k({variant:a,size:n,className:e})),ref:o,...i})));z.displayName="Button";const M=e.forwardRef((({className:e,type:a,...n},s)=>t.jsx("input",{type:a,className:P("flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-sm shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",e),ref:s,...n})));function F({className:e,classNames:i,showOutsideDays:o=!0,...r}){return t.jsx(a,{locale:y,showOutsideDays:o,className:P("p-4",e),classNames:{months:"flex flex-col space-y-4",month:"space-y-4",caption:"flex justify-center pt-1 relative items-center",caption_label:"text-sm font-medium text-gray-900",nav:"space-x-1 flex items-center",nav_button:P(k({variant:"outline"}),"h-7 w-7 bg-transparent p-0 text-gray-600 hover:bg-gray-100"),nav_button_previous:"absolute left-1",nav_button_next:"absolute right-1",table:"w-full border-collapse space-y-1",head_row:"flex",head_cell:P("text-gray-500 rounded-md w-9 font-normal text-[0.8rem] text-center"),row:"flex w-full mt-2",cell:P("relative p-0 text-center text-sm focus-within:relative focus-within:z-20","h-9 w-9 text-gray-600 hover:bg-gray-100 rounded-lg transition-colors","first:text-red-500 last:text-red-500","[&:has([aria-selected])]:bg-gray-100"),day:P("h-9 w-9 p-0 font-normal text-center","hover:bg-gray-100 hover:text-gray-900 rounded-lg transition-colors","focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2"),day_range_end:"day-range-end",day_selected:P("bg-blue-600 text-white hover:bg-blue-700 hover:text-white","rounded-lg transition-colors focus:outline-none"),day_today:"bg-gray-100 text-gray-900",day_outside:"text-gray-400 opacity-50",day_disabled:"text-gray-400 opacity-50",day_range_middle:"aria-selected:bg-gray-100 aria-selected:text-gray-900",day_hidden:"invisible",...i},components:{IconLeft:({...e})=>t.jsx(n,{className:"h-4 w-4"}),IconRight:({...e})=>t.jsx(s,{className:"h-4 w-4"})},...r})}M.displayName="Input",F.displayName="Calendar";const J=r,H=d,U=e.forwardRef((({className:e,align:a="center",sideOffset:n=4,...s},r)=>t.jsx(i,{children:t.jsx(o,{ref:r,align:a,sideOffset:n,className:P("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...s})})));function V({value:e,onChange:a,placeholder:n}){return t.jsxs(J,{children:[t.jsx(H,{asChild:!0,children:t.jsxs(z,{variant:"outline",className:P("w-full justify-start text-left font-normal",!e&&"text-muted-foreground"),children:[t.jsx(l,{className:"mr-2 h-4 w-4"}),e?N(e,"P",{locale:y}):n||"Selecione uma data"]})}),t.jsx(U,{className:"w-auto p-0 bg-white shadow-lg border border-gray-200",align:"start",children:t.jsx(F,{mode:"single",selected:e,onSelect:a,initialFocus:!0,className:"bg-white rounded-lg",classNames:{months:"space-y-4",month:"space-y-4",caption:"flex justify-center pt-1 relative items-center",caption_label:"text-sm font-medium text-gray-900",nav:"space-x-1 flex items-center",nav_button:P("h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100 transition-opacity","hover:bg-gray-100 rounded-lg","disabled:opacity-30 disabled:hover:bg-transparent"),nav_button_previous:"absolute left-1",nav_button_next:"absolute right-1",table:"w-full border-collapse space-y-1",head_row:"flex",head_cell:P("text-gray-500 rounded-md w-9 font-normal text-[0.8rem]","text-center"),row:"flex w-full mt-2",cell:P("relative p-0 text-center text-sm focus-within:relative focus-within:z-20","h-9 w-9 text-gray-600 hover:bg-gray-100 rounded-lg transition-colors","first:text-red-500 last:text-red-500","[&:has([aria-selected])]:bg-gray-100"),day:P("h-9 w-9 p-0 font-normal","aria-selected:opacity-100"),day_range_end:"day-range-end",day_selected:P("bg-blue-600 text-white hover:bg-blue-700 hover:text-white","rounded-lg transition-colors focus:outline-none"),day_today:"bg-gray-100 text-gray-900",day_outside:"text-gray-400 opacity-50",day_disabled:"text-gray-400 opacity-50",day_range_middle:"aria-selected:bg-gray-100 aria-selected:text-gray-900",day_hidden:"invisible"},components:{IconLeft:({...e})=>t.jsx(l,{className:"h-4 w-4",...e}),IconRight:({...e})=>t.jsx(l,{className:"h-4 w-4",...e})}})})]})}U.displayName=o.displayName;const q="safeprag_os_counter",B="safeprag_company_data",Q="safeprag_service_order_pdfs",G=()=>{try{const e=JSON.parse(localStorage.getItem(Q)||"{}"),t=new Date,a=Object.entries(e).reduce(((e,[a,n])=>{const s=new Date(n.createdAt);return(t.getTime()-s.getTime())/864e5<=30&&(e[a]=n),e}),{});localStorage.setItem(Q,JSON.stringify(a))}catch(e){}},W=async e=>{try{const a=(()=>{try{const e=localStorage.getItem(q);let t=1;return e&&(t=parseInt(e)+1),localStorage.setItem(q,t.toString()),t}catch(e){return 1}})();e.orderNumber=a.toString();const n=localStorage.getItem(B);let s;if(n)try{s=JSON.parse(n)}catch(t){s={name:"",cnpj:"",address:"",phone:"",email:""}}else s={name:"",cnpj:"",address:"",phone:"",email:""};const i=localStorage.getItem("client_signature_data");let o=null;if(i)try{o=JSON.parse(i)}catch(t){}const r=localStorage.getItem("safeprag_service_orders"),d=(r?JSON.parse(r):[]).find((e=>"in_progress"===e.status));if(d){const t=localStorage.getItem("safeprag_schedules"),a=(t?JSON.parse(t):[]).find((e=>e.id===d.scheduleId));if(a){const t=localStorage.getItem("safeprag_clients"),n=(t?JSON.parse(t):[]).find((e=>e.id===a.clientId));e.client={code:n?.code||a.clientId||"N/A",name:n?.name||a.clientName||"Cliente não selecionado",branch:n?.branch||a.clientBranch||n?.name||"N/A",document:n?.document||a.clientDocument||"N/A",address:n?.address||a.clientAddress||"N/A",contact:n?.contact||a.clientContact||"N/A",phone:n?.phone||a.clientPhone||"N/A",email:n?.email||a.clientEmail||"N/A"}}}const l=e=>{if(!e)return"";try{const t=new Date(e);return isNaN(t.getTime())?e:t.toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric"})}catch(t){return e}},c=e=>{if(!e)return"--:--:--";try{const t=e.split(":");return t.length<3?`${t[0]}:${t[1]}:00`:`${t[0]}:${t[1]}:${t[2]}`}catch(t){return e}},m=(e,a)=>{if(!e||!a)return"";try{const[t,n,s]=e.split(":").map(Number),[i,o,r]=a.split(":").map(Number);let d=3600*i+60*o+r-(3600*t+60*n+s);d<0&&(d+=86400);const l=Math.floor(d/3600),c=Math.floor(d%3600/60);return`${l}h ${c}min ${d%60}s`}catch(t){return""}},g=document.createElement("div");g.className="report-container";const p=document.createElement("style");p.textContent="\n      @page {\n        margin: 10mm 10mm 10mm 10mm;\n      }\n      .report-container {\n        padding: 0;\n        font-family: Arial, sans-serif;\n      }\n      .section-container {\n        page-break-inside: avoid;\n        margin-bottom: 10px;\n      }\n      .complementary-section {\n        margin-top: 20px;\n      }\n      table {\n        margin: 0;\n        padding: 0;\n        page-break-inside: avoid;\n      }\n    ",document.head.appendChild(p);const u=document.createElement("div");u.style.width="100%",u.style.margin="0",u.style.padding="0",u.innerHTML=`\n      <table style="width: 100%; border-collapse: collapse;">\n        <tr>\n          <td style="width: 33%; vertical-align: top;">\n            <img src="${s?.logoUrl||""}" alt="Logo" style="width: 150px; margin-bottom: 5px;">\n          </td>\n          <td style="width: 33%; text-align: center; vertical-align: middle;">\n            <div style="font-size: 18px; font-weight: bold;">\n              Ordem De Serviço\n            </div>\n          </td>\n          <td style="width: 33%; text-align: right; vertical-align: top;">\n            <div style="font-size: 14px; font-weight: bold; color: #000;">\n              Nº O.S.: ${e.orderNumber}\n            </div>\n          </td>\n        </tr>\n      </table>\n      <table style="width: 100%; border-collapse: collapse; margin-top: 5px; font-size: 12px;">\n        <tr>\n          <td style="width: 70%; line-height: 1.3;">\n            <div>${s?.name||""}</div>\n            <div>CNPJ: ${s?.cnpj||""}</div>\n            <div>Endereço: ${s?.address||""}</div>\n            <div>Telefone: ${s?.phone||""}</div>\n            <div>Email: ${s?.email||""}</div>\n          </td>\n          <td style="width: 30%; text-align: right; line-height: 1.3;">\n            <div>Data: ${l(e.date)}</div>\n            <div>Hora Início: ${c(e.startTime)}</div>\n            <div>Hora Fim: ${c(e.endTime)}</div>\n            <div>Duração: ${m(e.startTime,e.endTime)}</div>\n          </td>\n        </tr>\n      </table>\n    `;const h=document.createElement("div");h.style.width="100%",h.style.display="flex",h.style.justifyContent="space-between",h.style.fontSize="12px",h.style.marginTop="5px",h.style.marginBottom="5px",h.style.paddingTop="5px",h.style.borderTop="1px solid #000";const x=document.createElement("div");x.innerHTML=`Licença Ambiental: ${s?.environmentalLicense?.number||"000000"} - Data: ${l(s?.environmentalLicense?.date)||"11/07/2024"}`;const b=document.createElement("div");b.style.textAlign="right",b.innerHTML=`Alvará Sanitário: ${s?.sanitaryPermit?.number||"000000"} - Validade: ${l(s?.sanitaryPermit?.expiryDate)||"11/05/2025"}`,h.appendChild(x),h.appendChild(b);const f=document.createElement("div");f.style.width="100%",f.style.height="1px",f.style.backgroundColor="#000",f.style.margin="5px 0";const y=document.createElement("div");y.style.marginTop="10px",y.innerHTML="";const N=document.createElement("div");N.style.margin="0",N.style.padding="0",N.innerHTML=`\n      <div style="background-color: #1a73e8; color: white; padding: 5px 10px; margin: 10px 0;">Dados Do Cliente</div>\n      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; font-size: 11px;">\n        <div>\n          <div>Código Do Cliente: ${e.client.code||"N/A"}</div>\n          <div>Razão Social: ${e.client.branch||"Cliente não selecionado"}</div>\n          <div>Nome Fantasia: ${e.client.name||"Cliente não selecionado"}</div>\n          <div>CNPJ/CPF: ${e.client.document||"N/A"}</div>\n        </div>\n        <div>\n          <div>Endereço: ${e.client.address||"N/A"}</div>\n          <div>Telefone: ${e.client.phone||"N/A"}</div>\n          <div>Contato: ${o?.contato||"N/A"}</div>\n          <div>Email: ${o?.emails?.[0]||"N/A"}</div>\n        </div>\n      </div>\n    `;const w=document.createElement("div");w.style.marginTop="20px",w.style.backgroundColor="#1a73e8",w.style.color="white",w.style.padding="5px 10px",w.innerHTML="Informações Dos Serviços";const j=document.createElement("div");j.style.marginTop="20px",j.innerHTML=`\n      <div style="font-weight: bold; margin-bottom: 10px;">Tratamento</div>\n      <table style="width: 100%; border-collapse: collapse; margin-bottom: 20px;">\n        <thead>\n          <tr style="background-color: #1a73e8; color: white;">\n            <th style="padding: 5px; text-align: left; border: 1px solid #ddd;">Serviço</th>\n            <th style="padding: 5px; text-align: left; border: 1px solid #ddd;">Praga Alvo</th>\n            <th style="padding: 5px; text-align: left; border: 1px solid #ddd;">Local</th>\n          </tr>\n        </thead>\n        <tbody>\n          <tr>\n            <td style="padding: 5px; border: 1px solid #ddd;">${e.service.type.charAt(0).toUpperCase()+e.service.type.slice(1)}</td>\n            <td style="padding: 5px; border: 1px solid #ddd;">${e.service.target.charAt(0).toUpperCase()+e.service.target.slice(1)}</td>\n            <td style="padding: 5px; border: 1px solid #ddd;">${e.service.location}</td>\n          </tr>\n        </tbody>\n      </table>\n\n      ${e.product?`\n      <div style="font-weight: bold; margin-bottom: 10px;">Produtos Utilizados</div>\n      <table style="width: 100%; border-collapse: collapse;">\n        <thead>\n          <tr style="background-color: #1a73e8; color: white;">\n            <th style="padding: 5px; text-align: left; border: 1px solid #ddd;">Produto (Concen.)</th>\n            <th style="padding: 5px; text-align: left; border: 1px solid #ddd; width: 10%;">Prin. Ativo</th>\n            <th style="padding: 5px; text-align: left; border: 1px solid #ddd;">Gru. Químico</th>\n            <th style="padding: 5px; border: 1px solid #ddd;">Registro</th>\n            <th style="padding: 5px; border: 1px solid #ddd;">Lote</th>\n            <th style="padding: 5px; border: 1px solid #ddd;">Validade</th>\n            <th style="padding: 5px; text-align: left; border: 1px solid #ddd;">Qtde.</th>\n            <th style="padding: 5px; text-align: left; border: 1px solid #ddd;">Diluente</th>\n          </tr>\n        </thead>\n        <tbody>\n          <tr>\n            <td style="padding: 5px; border: 1px solid #ddd;">${e.product.name}</td>\n            <td style="padding: 5px; border: 1px solid #ddd;">${e.product.activeIngredient}</td>\n            <td style="padding: 5px; border: 1px solid #ddd;">${e.product.chemicalGroup}</td>\n            <td style="padding: 5px; border: 1px solid #ddd;">${e.product.registration}</td>\n            <td style="padding: 5px; border: 1px solid #ddd;">${e.product.batch}</td>\n            <td style="padding: 5px; border: 1px solid #ddd;">${l(e.product.validity)}</td>\n            <td style="padding: 5px; border: 1px solid #ddd;">${e.product.quantity}</td>\n            <td style="padding: 5px; border: 1px solid #ddd;">${e.product.dilution}</td>\n          </tr>\n        </tbody>\n      </table>\n      `:""}\n    `;let S=null;["pulverizacao","atomizacao","termonebulizacao","polvilhamento","iscagem_gel","inspeção","inspeçao"].includes(e.service.type.toLowerCase())||(S=document.createElement("div"),S.style.marginTop="20px",S.innerHTML=`\n        <div style="font-weight: bold; margin-bottom: 10px;">Dispositivos Monitorados</div>\n        <table style="width: 100%; border-collapse: collapse;">\n          <thead>\n            <tr style="background-color: #1a73e8; color: white;">\n              <th style="padding: 5px; text-align: left; border: 1px solid #ddd;">Dispositivos</th>\n              <th style="padding: 5px; text-align: left; border: 1px solid #ddd; width: 10%;">Quant. Instalada</th>\n              <th style="padding: 5px; text-align: left; border: 1px solid #ddd;">Status</th>\n              <th style="padding: 5px; border: 1px solid #ddd;">Lista De Dispositivos</th>\n            </tr>\n          </thead>\n          <tbody>\n            ${e.devices.map((e=>`\n                <tr>\n                  <td style="padding: 5px; border: 1px solid #ddd;">${e.type}</td>\n                  <td style="padding: 5px; border: 1px solid #ddd;">${e.quantity}</td>\n                  <td style="padding: 5px; border: 1px solid #ddd; font-size: 10px;">\n                    ${e.status.sort(((e,t)=>e.name.localeCompare(t.name))).map(((t,a,n)=>{const s=(t.count/e.quantity*100).toFixed(1);return`\n                          <div style="font-size: 10px;">\n                            ${t.name} (${t.count} - ${s}%)\n                            ${a<n.length-1?"<br><br>":""}\n                          </div>\n                        `})).join("")}\n                  </td>\n                  <td style="padding: 5px; border: 1px solid #ddd; font-size: 10px;">\n                    ${e.status.sort(((e,t)=>e.name.localeCompare(t.name))).map(((e,t,a)=>{const n=(e=>{if(0===e.length)return"";const t=[...e].sort(((e,t)=>e-t)),a=[];let n=t[0],s=n;for(let i=1;i<=t.length;i++)i===t.length||t[i]!==s+1?(n===s?a.push(n.toString()):a.push(`${n}-${s}`),i<t.length&&(n=t[i],s=n)):s=t[i];return a.join(", ")})(e.devices);return`\n                          ${e.name}:\n                          <br>\n                          ${n}\n                          ${t<a.length-1?"<br><br>":""}\n                        `})).join("")}\n                  </td>\n                </tr>\n              `)).join("")}\n          </tbody>\n        </table>\n      `);const C=document.createElement("div");C.className="section-container complementary-section",C.style.marginTop="20px";const D=document.createElement("div");D.style.backgroundColor="#1a75ff",D.style.color="white",D.style.padding="5px 10px",D.style.marginBottom="20px",D.innerHTML="Informações Complementares",C.appendChild(D);const O=document.createElement("div");O.style.marginBottom="20px",O.innerHTML=`\n      <div style="margin-bottom: 10px;"><strong>Observações:</strong></div>\n      <div style="min-height: 80px; border: 1px solid #ddd; padding: 10px; margin-bottom: 20px;">\n        ${e.observations||""}\n      </div>\n    `,C.appendChild(O);const $=document.createElement("div"),E=JSON.parse(localStorage.getItem("userData")||"{}");$.style.display="flex",$.style.justifyContent="space-between",$.style.width="100%",$.style.marginTop="10px",$.style.marginBottom="20px",$.style.padding="0 20px";const I="\n      padding-top: 5px;\n      text-align: center;\n      width: 180px;\n    ";$.innerHTML=`\n      <div style="flex: 1; max-width: 180px;">\n        <div style="${I}">\n          ${E.signature?`<img src="${E.signature}" alt="Assinatura" style="width: 180px; height: 60px; margin-bottom: 5px; display: block;">`:""}\n          <div style="font-weight: bold; margin-top: 5px;">Controlador De Pragas</div>\n          ${E.name?`<div style="font-size: 11px; margin-top: 2px;">${E.name}</div>`:""}\n        </div>\n      </div>\n      <div style="flex: 1; max-width: 180px;">\n        <div style="${I}">\n          ${E.tecnicoSignature?`<img src="${E.tecnicoSignature}" alt="Assinatura" style="width: 180px; height: 60px; margin-bottom: 5px; display: block;">`:""}\n          <div style="font-weight: bold; margin-top: 5px;">Responsável Técnico</div>\n          ${E.tecnicoName?`<div style="font-size: 11px; margin-top: 2px;">${E.tecnicoName}</div>`:""}\n          ${E.tecnicoCrea?`<div style="font-size: 11px; margin-top: 2px;">CREA ${E.tecnicoCrea}</div>`:""}\n        </div>\n      </div>\n      <div style="flex: 1; max-width: 180px;">\n        <div style="${I}">\n          ${o?.signature?`<img src="${o.signature}" alt="Assinatura" style="width: 180px; height: 60px; margin-bottom: 5px; display: block;">`:""}\n          <div style="font-weight: bold; margin-top: 5px;">Contato Do Cliente</div>\n          ${o?.contato?`<div style="font-size: 11px; margin-top: 2px;">${o.contato}</div>`:""}\n        </div>\n      </div>\n    `,C.appendChild($),g.innerHTML=`\n      <div class="section-container">\n        ${u.outerHTML}\n        ${h.outerHTML}\n        ${f.outerHTML}\n        ${N.outerHTML}\n      </div>\n      <div class="section-container">\n        ${y.outerHTML}\n        ${w.outerHTML}\n        ${j.outerHTML}\n      </div>\n      ${S?`\n        <div class="section-container">\n          ${S.outerHTML}\n        </div>\n      `:""}\n      <div class="section-container">\n        ${C.outerHTML}\n      </div>\n    `;const A={margin:[10,10,10,10],filename:`ordem-servico-${e.orderNumber}.pdf`,image:{type:"jpeg",quality:.98},html2canvas:{scale:2,useCORS:!0,logging:!1,windowWidth:794},jsPDF:{unit:"mm",format:"a4",orientation:"portrait"}},T=await v().set(A).from(g).toPdf().get("pdf"),R=T.internal.getNumberOfPages();for(let e=1;e<=R;e++){T.setPage(e),T.setFontSize(8),T.setTextColor(128);const t=T.internal.pageSize.getWidth(),a=T.internal.pageSize.getHeight();T.text(`${e}/${R}`,t-12,a-8,{align:"right"})}const _=T.output("blob");return((e,a)=>{try{G();const n=new FileReader;n.onloadend=()=>{const e=n.result.split(",")[1];let s="";try{const e=localStorage.getItem("controlador_pragas");e&&(s=JSON.parse(e).nome||"")}catch(t){}const i=JSON.parse(localStorage.getItem(Q)||"{}");i[a.orderNumber]={pdf:e,createdAt:(new Date).toISOString(),clientName:a.client.name,serviceType:a.service.type,orderNumber:a.orderNumber,clientCode:a.client.code,clientBranch:a.client.branch,technician:s},localStorage.setItem(Q,JSON.stringify(i))},n.readAsDataURL(e)}catch(t){throw t}})(_,e),_}catch(t){throw t}},Y=e.forwardRef((({className:e,...a},n)=>t.jsx("div",{className:"relative w-full overflow-auto",children:t.jsx("table",{ref:n,className:P("w-full caption-bottom text-sm",e),...a})})));Y.displayName="Table";const X=e.forwardRef((({className:e,...a},n)=>t.jsx("thead",{ref:n,className:P("[&_tr]:border-b",e),...a})));X.displayName="TableHeader";const K=e.forwardRef((({className:e,...a},n)=>t.jsx("tbody",{ref:n,className:P("[&_tr:last-child]:border-0",e),...a})));K.displayName="TableBody";e.forwardRef((({className:e,...a},n)=>t.jsx("tfoot",{ref:n,className:P("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",e),...a}))).displayName="TableFooter";const Z=e.forwardRef((({className:e,...a},n)=>t.jsx("tr",{ref:n,className:P("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",e),...a})));Z.displayName="TableRow";const ee=e.forwardRef((({className:e,...a},n)=>t.jsx("th",{ref:n,className:P("h-10 px-2 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",e),...a})));ee.displayName="TableHead";const te=e.forwardRef((({className:e,...a},n)=>t.jsx("td",{ref:n,className:P("p-2 align-middle [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",e),...a})));te.displayName="TableCell";function ae({rows:e,columns:a,getRowId:n,pageSize:s=30,localeText:i}){const[o,r]=c.useState(0),d=Math.ceil(e.length/s),l=o*s,m=l+s,g=e.slice(l,m);return t.jsxs("div",{className:"space-y-4",children:[t.jsx("div",{className:"overflow-x-auto",children:t.jsxs(Y,{children:[t.jsx(X,{children:t.jsx(Z,{children:a.map((e=>t.jsx(ee,{className:"whitespace-nowrap",style:e.width?{width:e.width}:void 0,children:e.headerName},e.field)))})}),t.jsx(K,{children:0===g.length?t.jsx(Z,{children:t.jsx(te,{colSpan:a.length,className:"text-center",children:i?.noRowsLabel||"Nenhum registro encontrado"})}):g.map((e=>t.jsx(Z,{children:a.map((a=>t.jsx(te,{className:"whitespace-nowrap",children:a.renderCell?a.renderCell({row:e}):e[a.field]},a.field)))},n(e))))})]})}),d>1&&t.jsxs("div",{className:"flex items-center justify-between px-2",children:[t.jsxs("div",{className:"text-sm text-gray-700",children:["Mostrando ",l+1,"-",Math.min(m,e.length)," de ",e.length]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx("button",{onClick:()=>r((e=>Math.max(0,e-1))),disabled:0===o,className:"px-3 py-1 text-sm bg-gray-100 rounded disabled:opacity-50",children:"Anterior"}),t.jsx("button",{onClick:()=>r((e=>Math.min(d-1,e+1))),disabled:o===d-1,className:"px-3 py-1 text-sm bg-gray-100 rounded disabled:opacity-50",children:"Próxima"})]})]})]})}e.forwardRef((({className:e,...a},n)=>t.jsx("caption",{ref:n,className:P("mt-4 text-sm text-muted-foreground",e),...a}))).displayName="TableCaption";const ne=({data:e,onViewServiceOrder:a,onViewCertificate:n})=>{const s=[{field:"numOS",headerName:"Num. O.S.",width:150},{field:"jde",headerName:"Código do Cliente",width:150},{field:"nomeFantasia",headerName:"Nome Fantasia",width:200},{field:"cadeia",headerName:"Razão Social",width:200},{field:"inicio",headerName:"Data",width:150},{field:"tecnico",headerName:"Controlador de Pragas",width:200},{field:"actions",headerName:"Ações",width:200,renderCell:e=>t.jsxs("div",{className:"space-x-2",children:[t.jsx(z,{className:"bg-blue-500 hover:bg-blue-600 text-white",onClick:()=>a(e.row.numOS),size:"sm",children:"Ordem de Serviço"}),("CERTIFICADO"===e.row.status||e.row.hasCertificate)&&t.jsx(z,{variant:"success",onClick:()=>n(e.row.numOS),size:"sm",children:"Certificado"})]})}];return t.jsxs("div",{children:[t.jsx("div",{className:"space-y-4 md:hidden",children:e.map((e=>t.jsxs("div",{className:"bg-white rounded-lg shadow p-4 space-y-3",children:[t.jsxs("div",{className:"flex justify-between items-start",children:[t.jsxs("div",{children:[t.jsxs("div",{className:"font-semibold text-gray-900",children:["OS #",e.numOS]}),t.jsx("div",{className:"text-sm text-gray-600",children:e.nomeFantasia})]}),t.jsx("div",{className:"text-sm text-gray-500",children:e.inicio})]}),t.jsx("div",{className:"text-sm",children:t.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[t.jsx("div",{className:"text-gray-500",children:"Código:"}),t.jsx("div",{children:e.jde}),t.jsx("div",{className:"text-gray-500",children:"Razão Social:"}),t.jsx("div",{children:e.cadeia}),t.jsx("div",{className:"text-gray-500",children:"Controlador:"}),t.jsx("div",{children:e.tecnico})]})}),t.jsxs("div",{className:"flex space-x-2 pt-2",children:[t.jsx(z,{className:"bg-blue-500 hover:bg-blue-600 text-white flex-1",onClick:()=>a(e.numOS),size:"sm",children:"Ordem de Serviço"}),("CERTIFICADO"===e.status||e.hasCertificate)&&t.jsx(z,{variant:"success",onClick:()=>n(e.numOS),size:"sm",className:"flex-1",children:"Certificado"})]})]},e.numOS)))}),t.jsx("div",{className:"hidden md:block",children:t.jsx(ae,{rows:e,columns:s,getRowId:e=>e.numOS,pageSize:100,localeText:{noRowsLabel:"Nenhuma ordem de serviço encontrada",footerRowSelected:e=>`${e} ordem${1!==e?"s":""} selecionada${1!==e?"s":""}`}})})]})};function se(){const[a,n]=e.useState([]),[s,i]=e.useState({orderNumber:"",jde:"",clientName:"",startDate:null,endDate:null}),o=async()=>{try{const e=await O(),t=await(()=>{try{G();const e=localStorage.getItem(Q);return e?Object.entries(JSON.parse(e)).map((([e,t])=>({orderNumber:e,...t}))):[]}catch(e){return[]}})()||[],a=localStorage.getItem("userData"),s=a?JSON.parse(a):null,i=new Map;e.forEach((e=>{const t=new Date(e.createdAt);let a=e.controladorName;const n={numOS:e.id,jde:e.clientId||"",nomeFantasia:e.clientName,cadeia:e.clientBranch||e.clientName,inicio:t.toLocaleDateString(),inicioDate:t,tecnico:a||"Não informado",status:"in_progress"===e.status?"EM ANDAMENTO":"completed"===e.status?"CONCLUÍDO":"approved"===e.status?"APROVADO":"CANCELADO"};i.set(e.id,n)})),t.forEach((e=>{if(!e.orderNumber)return;const t=new Date(e.createdAt),a=i.get(e.orderNumber);if(a)a.hasCertificate=!0,a.status="CERTIFICADO";else{const a={numOS:e.orderNumber,jde:e.clientCode||"",nomeFantasia:e.clientName,cadeia:e.clientBranch||e.clientName,inicio:t.toLocaleDateString(),inicioDate:t,tecnico:s?.name||"Não informado",status:"CERTIFICADO",hasCertificate:!0};i.set(e.orderNumber,a)}}));const o=Array.from(i.values()).sort(((e,t)=>t.inicioDate.getTime()-e.inicioDate.getTime()));n(o)}catch(e){}};e.useEffect((()=>{o();const e=()=>{o()};return window.addEventListener("serviceOrdersUpdated",e),()=>{window.removeEventListener("serviceOrdersUpdated",e)}}),[]);return t.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[t.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 sm:gap-4",children:[t.jsx(M,{type:"text",placeholder:"Número da O.S.",value:s.orderNumber,onChange:e=>i({...s,orderNumber:e.target.value})}),t.jsx(M,{type:"text",placeholder:"Código do Cliente",value:s.jde,onChange:e=>i({...s,jde:e.target.value})}),t.jsx(M,{type:"text",placeholder:"Nome do Cliente",value:s.clientName,onChange:e=>i({...s,clientName:e.target.value})}),t.jsx(V,{placeholder:"Data Inicial",value:s.startDate,onChange:e=>i({...s,startDate:e})}),t.jsx(V,{placeholder:"Data Final",value:s.endDate,onChange:e=>i({...s,endDate:e})})]}),t.jsx("div",{className:"flex justify-end",children:t.jsx(z,{onClick:()=>{const e=a.filter((e=>{const t=!s.orderNumber||e.numOS.toLowerCase().includes(s.orderNumber.toLowerCase()),a=!s.jde||e.jde.toLowerCase().includes(s.jde.toLowerCase()),n=!s.clientName||e.nomeFantasia.toLowerCase().includes(s.clientName.toLowerCase())||e.cadeia.toLowerCase().includes(s.clientName.toLowerCase()),i=!s.startDate||new Date(e.inicioDate)>=s.startDate,o=!s.endDate||new Date(e.inicioDate)<=s.endDate;return t&&a&&n&&i&&o})).sort(((e,t)=>t.inicioDate.getTime()-e.inicioDate.getTime()));n(e)},className:"w-full sm:w-auto",children:"Buscar"})}),t.jsx(ne,{data:a,onViewServiceOrder:e=>{try{(e=>{try{const t=JSON.parse(localStorage.getItem(Q)||"{}")[e];if(!t)throw new Error(`PDF não encontrado para a ordem de serviço ${e}`);if(!t.pdf)throw new Error(`Dados do PDF inválidos para a ordem de serviço ${e}`);const a=atob(t.pdf),n=new Uint8Array(a.length);for(let e=0;e<a.length;e++)n[e]=a.charCodeAt(e);const s=new Blob([n],{type:"application/pdf"}),i=window.URL.createObjectURL(s),o=document.createElement("a");o.href=i,o.download=`ordem-servico-${e}-${t.clientName}.pdf`,document.body.appendChild(o),o.click(),setTimeout((()=>{document.body.removeChild(o),window.URL.revokeObjectURL(i)}),100)}catch(t){throw t}})(e)}catch(t){}},onViewCertificate:async e=>{try{const t=a.find((t=>t.numOS===e));if(!t)return;const n=t.inicio.split("/"),s=new Date(parseInt(n[2]),parseInt(n[1])-1,parseInt(n[0])),i=new Date(s);i.setMonth(i.getMonth()+1);const o={orderNumber:t.numOS,client:{name:t.nomeFantasia,document:t.jde,address:t.clientAddress||"",branch:t.cadeia},serviceType:t.serviceType||"Controle de Pragas",targetPests:t.targetPests||["Insetos","Roedores"],locations:t.locations||["Área Interna","Área Externa"],products:t.products||[],serviceDate:s.toISOString(),validUntil:i.toISOString()};await(async e=>{try{const t=localStorage.getItem(B);let a=t?JSON.parse(t):{name:"",cnpj:"",address:"",phone:"",email:""};const n=e=>{if(!e)return"";try{return new Date(e).toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric"})}catch(t){return e}},s=`\n      <div style="padding: 40px 60px; font-family: Arial, sans-serif; max-width: 1000px; margin: 0 auto; font-size: 11px; page-break-after: avoid;">\n        \x3c!-- Cabeçalho --\x3e\n        <div style="margin-bottom: 40px;">\n          <div style="width: 240px;">\n            ${a.logoUrl?`<img src="${a.logoUrl}" alt="Logo" style="width: 100%; height: auto;">`:""}\n          </div>\n          <h1 style="color: #0066cc; font-size: 24px; margin: 20px 0 0; text-align: center;">CERTIFICADO</h1>\n        </div>\n\n        \x3c!-- Texto do certificado --\x3e\n        <p style="text-align: justify; margin-bottom: 15px; line-height: 1.4;">\n          Certificamos para os devidos fins que a empresa: ${e.client.name}, situada à \n          ${e.client.address}, CNPJ ${e.client.document}, \n          encontra-se sob os serviços de controle de insetos e de roedores.\n        </p>\n\n        <p style="text-align: justify; margin-bottom: 15px; line-height: 1.4;">\n          Informamos ainda que os tratamentos: desratizações, inspeções e aplicação de pesticidas são realizadas conforme \n          ordem de serviço em anexo. Estes Serviços são desenvolvidos pela ${a.name}, \n          onde utilizamos os produtos abaixo relacionados.\n        </p>\n\n        <p style="margin-bottom: 25px; line-height: 1.4;">\n          Temos como estratégia de trabalho os métodos de iscagem, pulverização, atomização e polvilhamento.\n        </p>\n\n        \x3c!-- Tabela de Serviços --\x3e\n        <table style="width: 100%; border-collapse: collapse; margin-bottom: 20px;">\n          <tr style="background-color: #0066cc; color: white;">\n            <th style="padding: 8px; text-align: center; border: 1px solid #fff; width: 33%;">Serviço</th>\n            <th style="padding: 8px; text-align: center; border: 1px solid #fff; width: 33%;">Praga Alvo</th>\n            <th style="padding: 8px; text-align: center; border: 1px solid #fff; width: 33%;">Local</th>\n          </tr>\n          <tr>\n            <td style="padding: 8px; border: 1px solid #ccc; text-align: center;">${e.serviceType||"Controle de Pragas"}</td>\n            <td style="padding: 8px; border: 1px solid #ccc; text-align: center;">${e.targetPests?.join(", ")||"Insetos, Sinantrópicos"}</td>\n            <td style="padding: 8px; border: 1px solid #ccc; text-align: center;">${e.locations?.join(", ")||"Área Interna, Área Externa"}</td>\n          </tr>\n        </table>\n\n        \x3c!-- Tabela de Produtos --\x3e\n        <table style="width: 100%; border-collapse: collapse; margin-bottom: 40px;">\n          <tr style="background-color: #0066cc; color: white;">\n            <th style="padding: 8px; text-align: center; border: 1px solid #fff; width: 20%;">Produto</th>\n            <th style="padding: 8px; text-align: center; border: 1px solid #fff; width: 20%;">Registro</th>\n            <th style="padding: 8px; text-align: center; border: 1px solid #fff; width: 20%;">Praga Alvo</th>\n            <th style="padding: 8px; text-align: center; border: 1px solid #fff; width: 20%;">Ação Tóxica</th>\n            <th style="padding: 8px; text-align: center; border: 1px solid #fff; width: 20%;">Grupo Químico</th>\n          </tr>\n          ${e.products?.map((e=>`\n            <tr>\n              <td style="padding: 8px; border: 1px solid #ccc; text-align: center;">${e.name}</td>\n              <td style="padding: 8px; border: 1px solid #ccc; text-align: center;">${e.registration||""}</td>\n              <td style="padding: 8px; border: 1px solid #ccc; text-align: center;">${e.targetPest||""}</td>\n              <td style="padding: 8px; border: 1px solid #ccc; text-align: center;">${e.toxicAction||""}</td>\n              <td style="padding: 8px; border: 1px solid #ccc; text-align: center;">${e.chemicalGroup||""}</td>\n            </tr>\n          `)).join("")||""}\n        </table>\n\n        \x3c!-- Informações de Registro --\x3e\n        <p style="margin-bottom: 8px; line-height: 1.4;">\n          A ${a.name} encontra-se registrada nos órgãos competentes conforme dados abaixo:\n        </p>\n        <p style="margin-bottom: 5px; line-height: 1.4;">\n          Licença Ambiental: ${a.environmentalLicense?.number||""} Validade: ${n(a.environmentalLicense?.date||"")}\n        </p>\n        <p style="margin-bottom: 20px; line-height: 1.4;">\n          Alvará Sanitário: ${a.sanitaryPermit?.number||""} Validade: ${n(a.sanitaryPermit?.expiryDate||"")}\n        </p>\n\n        \x3c!-- Datas --\x3e\n        <p style="margin-bottom: 5px; line-height: 1.4;">Data dos Serviços: ${n(e.serviceDate)}</p>\n        <p style="margin-bottom: 5px; line-height: 1.4;">Validade deste Certificado: ${n(e.validUntil)}</p>\n        <p style="margin-bottom: 40px; line-height: 1.4;">As datas dos serviços constam nas respectivas Ordens de Serviços.</p>\n\n        \x3c!-- Área de assinatura --\x3e\n        <div style="display: flex; justify-content: flex-end; margin: 20px 0;">\n          <div style="text-align: center;">\n            <div style="border-top: 1px solid #000; width: 220px; padding-top: 5px;">\n              <p style="margin: 0; line-height: 1.3;">BRUNO ALEXANDRE CORREA</p>\n              <p style="margin: 0; line-height: 1.3;">RESPONSÁVEL TÉCNICO</p>\n              <p style="margin: 0; line-height: 1.3;">CREA 161869/D</p>\n            </div>\n          </div>\n        </div>\n\n        \x3c!-- Rodapé --\x3e\n        <div style="text-align: center; font-size: 10px; margin-top: 10px;">\n          <p style="margin: 0; line-height: 1.3;">${a.name} - ${a.address} - CNPJ: ${a.cnpj}</p>\n          <p style="margin: 0; line-height: 1.3;">Centro de Informação Toxicológica do Rio Grande do Sul - (51) 2139-9200 / 2139-9230</p>\n          <p style="margin: 0; text-align: right;">0001</p>\n        </div>\n      </div>\n    `,i={margin:0,filename:`certificado_${e.orderNumber}.pdf`,image:{type:"jpeg",quality:.98},html2canvas:{scale:2,useCORS:!0,logging:!1,windowWidth:1123,height:794},jsPDF:{unit:"mm",format:"a4",orientation:"landscape",putOnlyUsedFonts:!0,compress:!0}},o=document.createElement("div");o.innerHTML=s,document.body.appendChild(o);const r=await v().from(o).set(i).save();return document.body.removeChild(o),r}catch(t){throw t}})(o)}catch(t){}}})]})}function ie({value:a,onChange:n}){const[s,i]=e.useState(["Area interna","Area externa"]),[o,r]=e.useState(!1),[d,l]=e.useState("");return t.jsxs("div",{className:"flex flex-col gap-2",children:[t.jsxs("select",{value:a,onChange:e=>{const t=e.target.value;"custom"===t?r(!0):n(t)},className:"w-full p-2 border rounded-md",children:[t.jsx("option",{value:"",children:"Selecione o local"}),s.map((e=>t.jsx("option",{value:e,children:e},e))),t.jsx("option",{value:"custom",children:"Adicionar novo local..."})]}),o&&t.jsxs("div",{className:"flex gap-2",children:[t.jsx("input",{type:"text",value:d,onChange:e=>l(e.target.value),placeholder:"Digite o novo local",className:"flex-1 p-2 border rounded-md"}),t.jsx("button",{onClick:()=>{d.trim()&&(i([...s,d.trim()]),n(d.trim()),l(""),r(!1))},className:"px-4 py-2 text-white bg-blue-500 rounded-md hover:bg-blue-600",children:"Adicionar"}),t.jsx("button",{onClick:()=>{r(!1),l("")},className:"px-4 py-2 text-gray-600 bg-gray-200 rounded-md hover:bg-gray-300",children:"Cancelar"})]})]})}const oe=["Porta isca","Placa adesiva","Armadilha mecânica","Armadilha luminosa","Armadilha biológica","Armadilha feromônio"],re=["Conforme","Mofada","Consumida","Deteriorada","Sem acesso","Dispositivo danificado","Sem Dispositivo","Refil substituído","Atrativo biológico substituído","Desarmada","Desligada","Praga encontrada"],de=({selectedDevice:e,onDeviceChange:a,disabled:n=!1})=>t.jsxs("div",{children:[t.jsx("label",{className:"block text-lg font-semibold text-gray-700 mb-2",children:"Tipo de Dispositivo"}),t.jsxs("select",{value:e,onChange:e=>a(e.target.value),disabled:n,className:"w-full rounded-lg border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 text-base disabled:bg-gray-100",children:[t.jsx("option",{value:""}),oe.map((e=>t.jsx("option",{value:e,children:e},e)))]})]}),le=({selectedStatus:a,onStatusChange:n,onSelectAll:s,disabled:i=!1,selectedDevice:o})=>{const[r,d]=e.useState(!1),[l,c]=e.useState(""),m=[...re];"Armadilha luminosa"===o&&m.push("Lâmpada queimada");const g=m.filter((e=>{if("Porta isca"===o){return!["Refil substituído","Atrativo biológico substituído","Desarmada","Desligada"].includes(e)}if("Placa adesiva"===o){return!["Mofada","Consumida","Deteriorada","Atrativo biológico substituído","Desarmada","Desligada"].includes(e)}if("Armadilha mecânica"===o){return!["Mofada","Consumida","Deteriorada","Refil substituído","Atrativo biológico substituído","Desligada"].includes(e)}if("Armadilha luminosa"===o){return!["Mofada","Consumida","Deteriorada","Atrativo biológico substituído","Desarmada"].includes(e)}if("Armadilha biológica"===o){return!["Mofada","Consumida","Deteriorada","Refil substituído","Desarmada","Desligada"].includes(e)}if("Armadilha feromônio"===o){return!["Mofada","Consumida","Deteriorada","Atrativo biológico substituído","Desarmada","Desligada"].includes(e)}return!0}));return t.jsxs("div",{children:[t.jsx("label",{className:"block text-lg font-semibold text-gray-700 mb-2",children:"Status do Dispositivo"}),t.jsxs("div",{className:"flex gap-2",children:[t.jsxs("select",{value:a,onChange:e=>{"novo_status"===e.target.value?d(!0):n(e.target.value)},disabled:i||!o,className:"w-full rounded-lg border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 text-base disabled:bg-gray-100",children:[t.jsx("option",{value:""}),g.map(((e,a)=>t.jsx("option",{value:e,children:`${a+1}. ${e}`},e))),t.jsx("option",{value:"novo_status",children:"+ Adicionar novo status"})]}),"Conforme"===a&&t.jsx("button",{onClick:s,className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed",disabled:i,children:"Selecionar Todos"})]}),r&&t.jsxs("div",{className:"mt-2 flex gap-2",children:[t.jsx("input",{type:"text",value:l,onChange:e=>c(e.target.value),placeholder:"Digite o novo status",className:"flex-1 rounded-lg border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"}),t.jsx("button",{onClick:()=>{l.trim()&&(n(l.trim()),c(""),d(!1))},className:"px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600",children:"Adicionar"}),t.jsx("button",{onClick:()=>{c(""),d(!1)},className:"px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600",children:"Cancelar"})]})]})},ce=({quantity:e,onQuantityChange:a,selectedDevice:n,disabled:s=!1})=>t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{htmlFor:"quantity",className:"block text-lg font-semibold text-gray-700 mb-2",children:"Quantidade total de dispositivos"}),t.jsx("input",{type:"number",id:"quantity",value:e,onChange:e=>a(e.target.value),min:"1",disabled:s||!n,className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-base disabled:bg-gray-100"})]}),me=({devices:e,onDeviceClick:a,selectedDeviceId:n})=>{const s=e.filter((e=>0!==e.number));return t.jsxs("div",{children:[t.jsxs("h2",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[t.jsx(m,{className:"h-5 w-5 text-blue-600"}),"Dispositivos Disponíveis"]}),t.jsx("div",{className:"flex flex-wrap gap-1",children:s.map((e=>t.jsx("button",{onClick:()=>(e=>{a(e.id)})(e),className:"w-9 h-9 flex items-center justify-center rounded border text-sm font-semibold hover:shadow-md transition-shadow "+(e.id===n?"bg-green-200 border-green-400 text-green-600":e.status?"bg-red-100 border-red-300 text-red-600":"bg-blue-50 border-blue-200 text-blue-600"),children:e.number},e.id)))}),0===s.length&&t.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"Nenhum dispositivo disponível."})]})},ge=({devices:e,selectedProduct:a})=>{const n=e.reduce(((e,t)=>{const a=t.type;return e[a]||(e[a]=[]),e[a].push(t),e}),{}),s=e=>{if(0===e.length)return"";const t=[...e].sort(((e,t)=>e-t)),a=[];let n=t[0],s=n;for(let i=1;i<=t.length;i++)i===t.length||t[i]!==s+1?(n===s?a.push(n.toString()):a.push(`${n}-${s}`),i<t.length&&(n=t[i],s=n)):s=t[i];return a.join(", ")};return 0===e.length?null:t.jsxs("div",{className:"mt-4 space-y-4",children:[a&&t.jsxs("div",{className:"p-4 bg-white rounded-lg border border-blue-200 shadow-sm mb-4",children:[t.jsx("h3",{className:"text-lg font-semibold text-blue-800 mb-3",children:"Produto Utilizado"}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsxs("p",{className:"text-sm text-gray-600",children:[t.jsx("span",{className:"font-medium",children:"Nome:"})," ",a.name]}),t.jsxs("p",{className:"text-sm text-gray-600",children:[t.jsx("span",{className:"font-medium",children:"Princípio Ativo:"})," ",a.activeIngredient]})]}),t.jsxs("div",{children:[t.jsxs("p",{className:"text-sm text-gray-600",children:[t.jsx("span",{className:"font-medium",children:"Grupo Químico:"})," ",a.chemicalGroup]}),t.jsxs("p",{className:"text-sm text-gray-600",children:[t.jsx("span",{className:"font-medium",children:"Quantidade:"})," ",a.quantity," ",a.measure]})]})]})]}),Object.entries(n).map((([e,a])=>{const n=a.reduce(((e,t)=>{const a=t.status||"Não definido";return e[a]||(e[a]=[]),e[a].push(t),e}),{}),i=Object.entries(n).sort((([e],[t])=>"Não definido"===e?1:"Não definido"===t?-1:e.localeCompare(t)));return t.jsxs("div",{className:"p-4 bg-white rounded-lg border border-gray-200 shadow-sm",children:[t.jsxs("div",{className:"flex justify-between items-center mb-3",children:[t.jsx("div",{className:"text-lg font-semibold text-gray-800",children:e}),t.jsxs("div",{className:"px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm font-medium",children:["Total: ",a.length]})]}),t.jsx("div",{className:"space-y-2",children:i.map((([n,i])=>{const o=(i.length/a.length*100).toFixed(1);return t.jsx("div",{className:"p-3 rounded-md "+("Conforme"===n?"bg-green-50 border border-green-200":"Não definido"===n?"bg-gray-50 border border-gray-300":"Sem Dispositivo"===n||"Dispositivo danificado"===n?"bg-red-50 border border-red-200":"bg-blue-50 border border-blue-200"),children:t.jsxs("div",{className:"flex flex-col space-y-2",children:[t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsx("span",{className:"font-medium "+("Conforme"===n?"text-green-700":"Não definido"===n?"text-gray-600":"Sem Dispositivo"===n||"Dispositivo danificado"===n?"text-red-700":"text-blue-700"),children:n}),t.jsx("div",{className:"flex items-center space-x-2",children:t.jsxs("span",{className:"text-sm font-medium text-gray-600",children:[i.length," (",o,"%)"]})})]}),t.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2.5",children:t.jsx("div",{className:"h-2.5 rounded-full "+("Conforme"===n?"bg-green-600":"Não definido"===n?"bg-gray-400":"Sem Dispositivo"===n||"Dispositivo danificado"===n?"bg-red-600":"bg-blue-600"),style:{width:`${o}%`}})}),t.jsxs("div",{className:"text-sm text-gray-600",children:["Números: ",s(i.map((e=>e.number)))]})]})},`${e}-${n}`)}))})]},e)}))]})},pe=({onProductSelect:a})=>{const[n,s]=e.useState([]),[i,o]=e.useState(""),[r,d]=e.useState(!1);e.useEffect((()=>{const e=(()=>{const e=localStorage.getItem("safeprag_products");return e?JSON.parse(e):[]})();s(e)}),[]);return t.jsxs("div",{className:"relative",children:[t.jsx("div",{className:"bg-white p-4 rounded-lg shadow border border-gray-200 cursor-pointer hover:shadow-md transition-shadow",onClick:()=>d(!r),children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(g,{className:"w-5 h-5 text-yellow-500"}),t.jsx("h3",{className:"font-semibold",children:"Produtos Utilizados"})]}),t.jsx("span",{className:"text-blue-600",children:i?n.find((e=>e.id===i))?.name:"Selecione um produto"})]})}),r&&t.jsx("div",{className:"absolute z-50 mt-2 w-full bg-white rounded-lg shadow-lg border border-gray-200 max-h-96 overflow-y-auto",children:0===n.length?t.jsx("div",{className:"p-4 text-gray-500 text-center",children:"Nenhum produto cadastrado"}):t.jsx("div",{className:"divide-y divide-gray-100",children:n.map((e=>{return t.jsxs("div",{className:"p-4 hover:bg-gray-50 cursor-pointer "+(i===e.id?"bg-blue-50":""),onClick:()=>(e=>{o(e);const t=n.find((t=>t.id===e));t&&a(t),d(!1)})(e.id),children:[t.jsxs("div",{className:"flex justify-between items-start",children:[t.jsxs("div",{children:[t.jsx("h4",{className:"font-medium text-gray-900",children:e.name}),t.jsx("p",{className:"text-sm text-gray-600",children:e.activeIngredient})]}),t.jsxs("div",{className:"text-right text-sm text-gray-500",children:[t.jsx("div",{children:`${e.unit} ${e.measure}`}),t.jsxs("div",{children:["Validade: ",(s=e.expirationDate,new Date(s).toLocaleDateString())]})]})]}),t.jsxs("div",{className:"mt-2 text-sm text-gray-600",children:[t.jsx("span",{className:"font-medium",children:"Registro:"})," ",e.registration,t.jsx("span",{className:"mx-2",children:"•"}),t.jsx("span",{className:"font-medium",children:"Lote:"})," ",e.batch]})]},e.id);var s}))})})]})},ue=({serviceType:a,targetPest:n,location:s,observations:i,applicationMethod:o,productAmount:r,state:d,startTime:l,endTime:c,isLoading:m,showDeviceModal:g,onServiceTypeChange:h,onTargetPestChange:x,onLocationChange:b,onApplicationMethodChange:v,onProductAmountChange:f,onObservationsChange:y,onOpenDeviceModal:N,onCloseDeviceModal:w,onFinishOS:j,onApproveOS:S,onProductSelect:C,onDeviceChange:D,onStatusChange:O,onQuantityChange:$,onDeviceClick:E,onSelectAll:I,onSaveDevices:A,canFinishOS:T,canSave:R})=>{const _=e.useRef(null),L=["pulverizacao","atomizacao","termonebulizacao","polvilhamento","iscagem_gel"].includes(a),P=L||"monitoramento"===a,[k,z]=e.useState(!1),[M,F]=e.useState(""),[J,H]=e.useState(!1),[U,V]=e.useState(""),[q,B]=e.useState(l);return e.useEffect((()=>{const e=localStorage.getItem("serviceStartTime");e&&B(new Date(e))}),[]),e.useEffect((()=>{const e=e=>{e.detail?.startTime&&B(new Date(e.detail.startTime))};return window.addEventListener("serviceStart",e),()=>{window.removeEventListener("serviceStart",e)}}),[]),e.useEffect((()=>{l&&B(l)}),[l]),e.useEffect((()=>{const e=e=>{e.detail?.success&&window.location.reload()};return window.addEventListener("serviceOrderFinished",e),()=>{window.removeEventListener("serviceOrderFinished",e)}}),[]),t.jsxs("div",{className:"space-y-4 p-4",ref:_,children:[t.jsxs("div",{className:"bg-white shadow rounded-lg p-6",children:[t.jsxs("div",{className:"flex justify-between items-center mb-6",children:[t.jsx("h2",{className:"text-lg font-semibold",children:"Ordem de Serviço"}),q&&t.jsxs("div",{className:"text-sm text-gray-600",children:[t.jsx("span",{className:"font-medium",children:"Início: "}),q.toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1})]})]}),t.jsxs("div",{className:"mb-6",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Tipo de Serviço *"}),t.jsxs("select",{value:a,onChange:e=>{"novo_servico"===e.target.value?H(!0):h(e)},className:"mt-1 block w-full pl-3 pr-10 py-2 text-base border border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md",required:!0,children:[t.jsx("option",{value:"",children:"Selecione o tipo de serviço"}),t.jsx("option",{value:"inspecao",children:"Inspeção"}),t.jsx("option",{value:"monitoramento",children:"Monitoramento"}),t.jsx("option",{value:"pulverizacao",children:"Pulverização"}),t.jsx("option",{value:"atomizacao",children:"Atomização"}),t.jsx("option",{value:"termonebulizacao",children:"Termonebulização"}),t.jsx("option",{value:"polvilhamento",children:"Polvilhamento"}),t.jsx("option",{value:"iscagem_gel",children:"Iscagem com gel"}),t.jsx("option",{value:"novo_servico",children:"+ Adicionar novo serviço"})]}),J&&t.jsxs("div",{className:"mt-2 flex gap-2",children:[t.jsx("input",{type:"text",value:U,onChange:e=>V(e.target.value),placeholder:"Digite o novo tipo de serviço",className:"flex-1 rounded-lg border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"}),t.jsx("button",{onClick:()=>{if(U.trim()){const e={target:{value:U.trim()}};h(e),V(""),H(!1)}},className:"px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600",children:"Adicionar"}),t.jsx("button",{onClick:()=>{V(""),H(!1)},className:"px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600",children:"Cancelar"})]})]}),t.jsxs("div",{className:"mb-6",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Praga Alvo *"}),t.jsxs("select",{value:n,onChange:e=>{"nova_praga"===e.target.value?z(!0):x(e.target.value)},className:"mt-1 block w-full pl-3 pr-10 py-2 text-base border border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md",required:!0,children:[t.jsx("option",{value:"",children:"Selecione a praga alvo"}),t.jsx("option",{value:"roedores",children:"Roedores"}),t.jsx("option",{value:"baratas",children:"Baratas"}),t.jsx("option",{value:"moscas",children:"Moscas"}),t.jsx("option",{value:"formigas",children:"Formigas"}),t.jsx("option",{value:"cupins",children:"Cupins"}),t.jsx("option",{value:"aranhas",children:"Aranhas"}),t.jsx("option",{value:"escorpioes",children:"Escorpiões"}),t.jsx("option",{value:"percevejos",children:"Percevejos"}),t.jsx("option",{value:"pulgas",children:"Pulgas"}),t.jsx("option",{value:"carrapatos",children:"Carrapatos"}),t.jsx("option",{value:"traças",children:"Traças"}),t.jsx("option",{value:"vespas",children:"Vespas"}),t.jsx("option",{value:"nova_praga",children:"+ Adicionar nova praga"})]}),k&&t.jsxs("div",{className:"mt-2 flex gap-2",children:[t.jsx("input",{type:"text",value:M,onChange:e=>F(e.target.value),placeholder:"Digite a nova praga alvo",className:"flex-1 rounded-lg border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"}),t.jsx("button",{onClick:()=>{M.trim()&&(x(M.trim()),F(""),z(!1))},className:"px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600",children:"Adicionar"}),t.jsx("button",{onClick:()=>{F(""),z(!1)},className:"px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600",children:"Cancelar"})]})]}),t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-600 mb-1",children:"Local *"}),t.jsx(ie,{value:s,onChange:b})]}),P&&t.jsxs("div",{className:"space-y-4",children:[t.jsx("h4",{className:"font-medium text-gray-900",children:"Foram utilizados produtos?"}),t.jsx(pe,{onProductSelect:C})]}),d.selectedProduct&&t.jsxs("div",{className:"mb-6",children:[t.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Quantidade de Produto (",d.selectedProduct.quantity,")"]}),t.jsxs("div",{className:"relative",children:[t.jsx("input",{type:"number",value:r,onChange:e=>f(e.target.value),className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm pr-16",placeholder:`Digite a quantidade em ${d.selectedProduct.quantity}`}),t.jsx("div",{className:"absolute inset-y-0 right-0 mt-1 pr-3 flex items-center pointer-events-none",children:t.jsx("span",{className:"text-gray-500 sm:text-sm",children:d.selectedProduct.quantity})})]})]}),!L&&t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:t.jsx("button",{onClick:N,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 mt-4",children:"Selecionar Dispositivos"})}),t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{htmlFor:"observations",className:"block text-lg font-semibold text-gray-700 mb-2",children:"Observações"}),t.jsx("textarea",{id:"observations",value:i,onChange:e=>y(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-base",rows:3,placeholder:"Digite as observações aqui..."})]}),l&&!c&&t.jsxs("div",{className:"text-green-600 font-medium mb-4",children:["OS em andamento - Iniciada às ",l.toLocaleTimeString()]}),t.jsxs("div",{className:"flex justify-end gap-2 mt-4",children:[t.jsxs("button",{onClick:j,className:"bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-md disabled:opacity-50 flex items-center gap-2",disabled:!T(),children:[t.jsx(p,{className:"h-5 w-5"}),m?t.jsx("span",{children:"Finalizando..."}):t.jsx("span",{children:"Finalizar OS"})]}),t.jsxs("button",{onClick:S,className:"bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-md flex items-center gap-2",children:[t.jsx(u,{className:"h-5 w-5"}),"Aprovar OS"]})]})]}),g&&t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:t.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-3xl max-h-[90vh] overflow-auto",children:[t.jsxs("div",{className:"sticky top-0 bg-white border-b border-gray-200 p-4 flex justify-between items-center",children:[t.jsx("h2",{className:"text-xl font-semibold",children:"Selecionar Dispositivos"}),t.jsx("button",{onClick:w,className:"text-gray-500 hover:text-gray-700",children:"✕"})]}),t.jsxs("div",{className:"p-4",children:[t.jsx("div",{className:"mb-6",children:t.jsx(de,{selectedDevice:d.selectedDevice,onDeviceChange:D,disabled:m})}),t.jsx("div",{className:"mb-6",children:t.jsx(le,{selectedStatus:d.selectedStatus,onStatusChange:O,onSelectAll:I,disabled:m,selectedDevice:d.selectedDevice})}),t.jsx("div",{className:"mb-6",children:t.jsx(ce,{quantity:d.quantity,onQuantityChange:$,selectedDevice:d.selectedDevice,disabled:m})}),d.devices.length>0&&t.jsx("div",{className:"bg-gray-50 rounded-lg p-4",children:t.jsx(me,{devices:d.devices,onDeviceClick:E})}),d.savedDevices.length>0&&t.jsxs("div",{className:"mt-6",children:[t.jsx("h3",{className:"font-medium text-gray-900 mb-3",children:"Dispositivos Salvos"}),t.jsx("div",{className:"bg-gray-50 rounded-lg p-4",children:t.jsx(ge,{devices:d.savedDevices,selectedProduct:d.selectedProduct})})]}),t.jsxs("div",{className:"mt-6 flex justify-end space-x-3",children:[t.jsx("button",{onClick:A,disabled:!R,className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed",children:"Salvar Dispositivos"}),t.jsx("button",{onClick:w,className:"px-6 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-400",children:"Fechar"})]})]})]})})]})};export{z as B,w as S,se as a,j as b,A as c,E as d,D as e,$ as f,W as g,C as h,ue as i,S as r,T as u};
