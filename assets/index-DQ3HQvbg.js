import{j as e,A as t,G as s,r as a,X as n,q as r,z as i,v as l,c,u as o,M as d,w as u,x as m,i as h,H as p,g as v,I as x,S as g,J as y,K as f,d as b,L as j,Q as N}from"./vendor-react-DXGt926u.js";import{v as S,I as w,f as E,p as T}from"./vendor-utils-BcyCYpIF.js";import{S as C}from"./feature-scheduler-BQWMySz3.js";import{A as D}from"./feature-admin-BsRO0gg_.js";import{S as A,g as I,u as O,i as P}from"./feature-activity-DWDuNooD.js";import"./vendor-CzUK4DuD.js";import"./vendor-pdf-DKPZ52ED.js";import"./vendor-ui-D3hghNPx.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const s of e)if("childList"===s.type)for(const e of s.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const _=({activeTab:t,onTabChange:s,items:a})=>e.jsx("nav",{className:"fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200",children:e.jsx("div",{className:"max-w-screen-xl mx-auto px-4",children:e.jsx("div",{className:"flex justify-between",children:a.map((a=>{const n=a.icon;return e.jsxs("button",{onClick:()=>s(a.id),className:"flex flex-col items-center py-2 px-4 "+(t===a.id?"text-blue-600":"text-gray-600 hover:text-blue-600"),children:[e.jsx(n,{className:"h-6 w-6"}),e.jsx("span",{className:"text-xs mt-1",children:a.label})]},a.id)}))})})});function k(){const a="/"===t().pathname;return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsxs("div",{className:"pb-16",children:[" ",e.jsx(s,{})]}),!a&&e.jsx(_,{})," "]})}const R="@safeprag:schedules",L=()=>{const e=localStorage.getItem(R);return e?JSON.parse(e):[]},z=e=>{localStorage.setItem(R,JSON.stringify(e))},q={async createSchedule(e){try{const t=(new Date).toISOString(),s={...e,id:S(),status:"scheduled",createdAt:t,updatedAt:t,startTime:null},a=L();return z([...a,s]),s.id}catch(t){throw t}},async updateScheduleStatus(e,t,s){try{const a=L().map((a=>a.id===e?{...a,status:t,updatedAt:(new Date).toISOString(),startTime:s||a.startTime}:a));z(a)}catch(a){throw a}},async getSchedules(e){try{let t=L();return e&&(t=t.filter((t=>{let s=!0;return e.status&&t.status!==e.status&&(s=!1),e.startDate&&new Date(t.date)<new Date(e.startDate)&&(s=!1),e.endDate&&new Date(t.date)>new Date(e.endDate)&&(s=!1),e.technician&&t.technician!==e.technician&&(s=!1),s}))),t.sort(((e,t)=>e.date.localeCompare(t.date)))}catch(t){throw t}}};function M({onClose:t,onSuccess:s}){const[i,l]=a.useState({name:"",service:"",date:"",time:"",address:"",phone:"",email:"",observations:"",technician:""}),c=e=>{const{name:t,value:s}=e.target;l((e=>({...e,[t]:s})))};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs(w.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},className:"bg-white rounded-lg shadow-lg p-6 max-w-2xl w-full mx-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Novo Agendamento"}),e.jsx("button",{onClick:t,className:"p-2 hover:bg-gray-100 rounded-full",children:e.jsx(n,{className:"w-6 h-6"})})]}),e.jsxs("form",{onSubmit:async e=>{e.preventDefault();try{await q.createSchedule(i),r.success("Agendamento criado com sucesso!"),s(),t()}catch(a){r.error("Erro ao criar agendamento")}},className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nome do Cliente"}),e.jsx("input",{type:"text",name:"name",required:!0,className:"w-full p-2 border rounded-lg",value:i.name,onChange:c})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Serviço"}),e.jsxs("select",{name:"service",required:!0,className:"w-full p-2 border rounded-lg",value:i.service,onChange:c,children:[e.jsx("option",{value:"",children:"Selecione um serviço"}),e.jsx("option",{value:"Dedetização",children:"Dedetização"}),e.jsx("option",{value:"Desratização",children:"Desratização"}),e.jsx("option",{value:"Descupinização",children:"Descupinização"}),e.jsx("option",{value:"Sanitização",children:"Sanitização"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Data"}),e.jsx("input",{type:"date",name:"date",required:!0,className:"w-full p-2 border rounded-lg",value:i.date,onChange:c})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Horário"}),e.jsx("input",{type:"time",name:"time",required:!0,className:"w-full p-2 border rounded-lg",value:i.time,onChange:c})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Telefone"}),e.jsx("input",{type:"tel",name:"phone",required:!0,className:"w-full p-2 border rounded-lg",value:i.phone,onChange:c})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email"}),e.jsx("input",{type:"email",name:"email",className:"w-full p-2 border rounded-lg",value:i.email,onChange:c})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Endereço"}),e.jsx("input",{type:"text",name:"address",required:!0,className:"w-full p-2 border rounded-lg",value:i.address,onChange:c})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Técnico Responsável"}),e.jsx("input",{type:"text",name:"technician",className:"w-full p-2 border rounded-lg",value:i.technician,onChange:c})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Observações"}),e.jsx("textarea",{name:"observations",rows:3,className:"w-full p-2 border rounded-lg",value:i.observations,onChange:c})]})]}),e.jsxs("div",{className:"flex justify-end space-x-4 pt-4",children:[e.jsx("button",{type:"button",onClick:t,className:"px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300",children:"Cancelar"}),e.jsx("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Criar Agendamento"})]})]})]})})}function U(){const[t,s]=a.useState([]),[x,g]=a.useState(null),[y,f]=a.useState(!1),[b,j]=a.useState(!1),[N,S]=a.useState(null),[C,D]=a.useState({}),[A,I]=a.useState(!1),[O,P]=a.useState(null);async function _(){try{const e=await q.getSchedules(C);if(s(e),b&&x){const t=e.find((e=>e.id===x.id));t&&g(t)}}catch(e){r.error("Erro ao carregar agendamentos")}}a.useEffect((()=>{_()}),[C]),a.useEffect((()=>{b&&_()}),[b]);a.useEffect((()=>{b&&x&&(async e=>{try{const t=await q.getScheduleById(e);t&&(g(t),S(t.startTime||null))}catch(t){r.error("Erro ao carregar dados do cliente")}})(x.id)}),[b]),a.useEffect((()=>{x&&S(x.startTime||null)}),[x]);return e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("div",{className:"flex justify-between items-center mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-800",children:"Agendamentos"}),e.jsxs("button",{onClick:()=>I(!0),className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:[e.jsx(i,{className:"w-5 h-5"}),"Novo Agendamento"]})]}),e.jsx("div",{className:"bg-white rounded-lg shadow-md p-4 mb-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("select",{className:"form-select",onChange:e=>D((t=>({...t,status:e.target.value}))),value:C.status||"",children:[e.jsx("option",{value:"",children:"Todos os status"}),e.jsx("option",{value:"scheduled",children:"Agendado"}),e.jsx("option",{value:"inProgress",children:"Em andamento"}),e.jsx("option",{value:"completed",children:"Concluído"})]}),e.jsx("input",{type:"date",className:"form-input",onChange:e=>D((t=>({...t,startDate:e.target.value}))),value:C.startDate||""}),e.jsx("input",{type:"date",className:"form-input",onChange:e=>D((t=>({...t,endDate:e.target.value}))),value:C.endDate||""})]})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:t.map((t=>e.jsxs(w.div,{whileHover:{scale:1.02},className:"bg-white rounded-lg shadow-md p-6 cursor-pointer\n              "+("completed"===t.status?"opacity-75":""),onClick:()=>(e=>{g(e),f(!0)})(t),children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx(l,{className:"w-5 h-5 text-gray-500 mr-2"}),e.jsx("h2",{className:"text-xl font-semibold",children:t.name})]}),e.jsxs("div",{className:"space-y-2 text-gray-600",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(c,{className:"w-4 h-4 mr-2"}),e.jsx("span",{children:E(new Date(t.date),"dd/MM/yyyy",{locale:T})})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(o,{className:"w-4 h-4 mr-2"}),e.jsx("span",{children:t.time})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(d,{className:"w-4 h-4 mr-2"}),e.jsx("span",{className:"truncate",children:t.address})]}),e.jsx("div",{className:"mt-4",children:e.jsx("span",{className:"inline-block px-3 py-1 rounded-full text-sm font-medium\n                  "+("scheduled"===t.status?"bg-blue-100 text-blue-800":"inProgress"===t.status?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800"),children:"scheduled"===t.status?"Agendado":"inProgress"===t.status?"Em andamento":"Concluído"})})]})]},t.id)))}),y&&x&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs(w.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},className:"bg-white rounded-lg shadow-lg p-6 max-w-lg w-full mx-4",children:[e.jsxs("div",{className:"flex justify-between items-start mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Ações do Agendamento"}),e.jsx("button",{onClick:()=>f(!1),className:"text-gray-500 hover:text-gray-700",children:e.jsx(n,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium mb-3",children:"Dados do Cliente"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(l,{className:"w-5 h-5 text-gray-500"}),e.jsx("span",{children:x.name})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(d,{className:"w-5 h-5 text-gray-500 mt-1"}),e.jsx("span",{className:"flex-1",children:x.address})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(l,{className:"w-5 h-5 text-gray-500"}),e.jsxs("span",{children:["Contato: ",x.contact||"Não informado"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(u,{className:"w-5 h-5 text-gray-500"}),e.jsx("span",{children:x.phone})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(o,{className:"w-5 h-5 text-gray-500"}),e.jsxs("span",{children:["Horário: ",x.time]})]}),"inProgress"===x.status&&e.jsx("div",{className:"inline-flex px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm",children:"Em Andamento"})]})]}),e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("button",{className:"w-full px-4 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 flex items-center justify-center gap-2",onClick:async()=>{if(x)try{const e=E(new Date,"HH:mm",{locale:T});await q.updateScheduleStatus(x.id,"inProgress",e),S(e),g((t=>t?{...t,status:"inProgress",startTime:e}:null)),f(!1),j(!0),await _()}catch(e){r.error("Erro ao iniciar serviço")}},disabled:"scheduled"!==x.status,children:[e.jsx(m,{className:"w-5 h-5"}),"Iniciar OS"]}),e.jsxs("button",{className:"w-full px-4 py-3 bg-red-600 text-white rounded-lg hover:bg-red-700 flex items-center justify-center gap-2",onClick:()=>{r.info("Funcionalidade em desenvolvimento")},children:[e.jsx(n,{className:"w-5 h-5"}),"Registrar Não Atendimento"]})]})]})]})}),b&&x&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs(w.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},className:"bg-white rounded-lg shadow-lg p-6 max-w-lg w-full mx-4",children:[e.jsx("h2",{className:"text-2xl font-bold mb-6",children:"Ordem de Serviço"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Tipo de Serviço *"}),e.jsxs("select",{className:"w-full p-2 border rounded-lg",children:[e.jsx("option",{value:"",children:"Selecione o tipo de serviço"}),e.jsx("option",{value:"dedetizacao",children:"Dedetização"}),e.jsx("option",{value:"desratizacao",children:"Desratização"}),e.jsx("option",{value:"sanitizacao",children:"Sanitização"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Praga Alvo *"}),e.jsxs("select",{className:"w-full p-2 border rounded-lg",children:[e.jsx("option",{value:"",children:"Selecione a praga alvo"}),e.jsx("option",{value:"baratas",children:"Baratas"}),e.jsx("option",{value:"ratos",children:"Ratos"}),e.jsx("option",{value:"formigas",children:"Formigas"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Local *"}),e.jsxs("select",{className:"w-full p-2 border rounded-lg",children:[e.jsx("option",{value:"",children:"Selecione o local"}),e.jsx("option",{value:"interno",children:"Área Interna"}),e.jsx("option",{value:"externo",children:"Área Externa"}),e.jsx("option",{value:"ambos",children:"Ambos"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Foram utilizados produtos?"}),e.jsxs("div",{className:"flex items-center gap-2 p-3 border rounded-lg",children:[e.jsx("div",{className:"p-2 bg-blue-50 rounded-lg",children:e.jsx(h,{className:"w-5 h-5 text-blue-600"})}),e.jsx("span",{className:"text-blue-600",children:"Produtos Utilizados"}),e.jsx("button",{className:"ml-auto text-blue-600",children:"Selecione um produto"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Observações"}),e.jsx("textarea",{className:"w-full p-2 border rounded-lg",rows:4,placeholder:"Digite as observações aqui..."})]}),e.jsxs("div",{className:"text-sm text-blue-600",children:["OS em andamento - Iniciada às ",x.startTime||N]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsxs("button",{className:"px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 flex items-center gap-2",onClick:async()=>{if(x)try{P(E(new Date,"HH:mm",{locale:T})),await q.updateScheduleStatus(x.id,"completed"),g((e=>e?{...e,status:"completed"}:null)),j(!1),await _(),r.success("Serviço finalizado com sucesso!")}catch(e){r.error("Erro ao finalizar serviço")}},children:[e.jsx(p,{className:"w-5 h-5"}),"Finalizar OS"]}),e.jsxs("button",{className:"px-4 py-2 bg-purple-500 text-white rounded-lg hover:bg-purple-600 flex items-center gap-2",children:[e.jsx(v,{className:"w-5 h-5"}),"Aprovar OS"]})]})]})]})}),A&&e.jsx(M,{onClose:()=>I(!1),onSuccess:_})]})}const V=a.createContext(void 0),G=({children:t})=>{const[s,n]=a.useState([]),r=a.useCallback(((e,t)=>{const s=Date.now();n((a=>[...a,{id:s,message:e,type:t}])),setTimeout((()=>{i(s)}),3e3)}),[]),i=a.useCallback((e=>{n((t=>t.filter((t=>t.id!==e))))}),[]);return e.jsx(V.Provider,{value:{showNotification:r,notifications:s,removeNotification:i},children:t})},J=()=>{const e=a.useContext(V);if(void 0===e)throw new Error("useNotification must be used within a NotificationProvider");return e},H=()=>{const{notifications:t}=J();return e.jsx("div",{className:"fixed top-4 right-4 z-50",children:t.map((t=>e.jsx("div",{className:"mb-2 p-4 rounded-lg shadow-lg text-white "+("success"===t.type?"bg-green-500":"bg-red-500"),children:t.message},t.id)))})},B=a.createContext({isActive:!1,lastActivity:null}),F=({children:t})=>{const[s,n]=a.useState(!0),[r,i]=a.useState(null);return a.useEffect((()=>{(async()=>{try{if(navigator.wakeLock){let e=null;const t=async()=>{try{e=await navigator.wakeLock.request("screen"),n(!0)}catch(t){n(!1)}};await t(),document.addEventListener("visibilitychange",(async()=>{"visible"===document.visibilityState&&await t()}))}}catch(e){n(!1)}})();const e=(()=>{const e=setInterval((()=>{const e=new Date;localStorage.setItem("lastActivity",e.toISOString()),i(e)}),3e4);return()=>clearInterval(e)})(),t=(()=>{const e=["mousemove","keydown","touchstart","scroll"],t=()=>{const e=new Date;localStorage.setItem("lastActivity",e.toISOString()),i(e)};return e.forEach((e=>{window.addEventListener(e,t)})),()=>{e.forEach((e=>{window.removeEventListener(e,t)}))}})();return()=>{e(),t()}}),[]),e.jsx(B.Provider,{value:{isActive:s,lastActivity:r},children:t})},$=a.forwardRef((({disabled:t=!1,onSignatureChange:s},n)=>{const r=a.useRef(null),[i,l]=a.useState(!1),[c,o]=a.useState(null),d=a.useRef(null);a.useEffect((()=>{const e=r.current;if(!e)return;const t=e.getContext("2d");t&&(t.strokeStyle="#000",t.lineWidth=2,t.lineCap="round",t.lineJoin="round",o(t),t.fillStyle="#fff",t.fillRect(0,0,e.width,e.height))}),[]);const u=e=>{if(!c||!i||t)return;const a=r.current;if(!a)return;let n;const l=a.getBoundingClientRect(),o=a.width/l.width,u=a.height/l.height;if(e instanceof MouseEvent)n={x:(e.clientX-l.left)*o,y:(e.clientY-l.top)*u};else{e.preventDefault();const t=e.touches[0];n={x:(t.clientX-l.left)*o,y:(t.clientY-l.top)*u}}d.current&&(c.beginPath(),c.moveTo(d.current.x,d.current.y),c.lineTo(n.x,n.y),c.stroke()),d.current=n,s(a.toDataURL())},m=e=>{if(t)return;l(!0);const s=r.current;if(!s)return;const a=s.getBoundingClientRect(),n=s.width/a.width,i=s.height/a.height;if(e.nativeEvent instanceof MouseEvent)d.current={x:(e.nativeEvent.clientX-a.left)*n,y:(e.nativeEvent.clientY-a.top)*i};else{e.preventDefault();const t=e.nativeEvent.touches[0];d.current={x:(t.clientX-a.left)*n,y:(t.clientY-a.top)*i}}},h=()=>{l(!1),d.current=null},p=()=>{c&&r.current&&(c.fillStyle="#fff",c.fillRect(0,0,r.current.width,r.current.height),s(""))};return a.useImperativeHandle(n,(()=>({clear:p}))),a.useEffect((()=>{const e=r.current;if(!e)return;const s=e=>u(e),a=e=>{e.preventDefault(),u(e)};return t||(e.addEventListener("mousemove",s,{passive:!1}),e.addEventListener("touchmove",a,{passive:!1}),e.addEventListener("touchstart",(e=>e.preventDefault()),{passive:!1})),()=>{e.removeEventListener("mousemove",s),e.removeEventListener("touchmove",a),e.removeEventListener("touchstart",(e=>e.preventDefault()))}}),[i,t]),e.jsx("div",{className:"relative w-full",children:e.jsx("canvas",{ref:r,width:500,height:200,onMouseDown:m,onMouseUp:h,onMouseOut:h,onTouchStart:m,onTouchEnd:h,style:{touchAction:"none",width:"100%",height:"auto"},className:"border border-gray-300 rounded cursor-"+(t?"not-allowed":"crosshair")})})})),Y=({isOpen:t,onClose:s,orderId:r,onSave:i})=>{const[l,c]=a.useState(""),[o,d]=a.useState(""),[u,m]=a.useState([""]),[h,p]=a.useState(""),[v,x]=a.useState(!1),g=a.useRef(null);J();return t?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-lg w-full shadow-xl",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Aprovação de Serviço"}),e.jsx("button",{type:"button",onClick:s,className:"text-gray-500 hover:text-gray-700",children:e.jsx(n,{className:"h-6 w-6"})})]}),e.jsx("div",{className:"mb-6",children:e.jsx("p",{className:"text-gray-800 text-base font-medium leading-relaxed",children:"Estou de acordo com o serviço realizado e tenho ciência sobre as informações contidas neste relatório."})}),e.jsxs("form",{onSubmit:async e=>{e.preventDefault();try{const e={name:l.trim(),phone:o.trim(),emails:u.filter((e=>""!==e.trim())),signature:h,contato:l.trim()};localStorage.setItem("client_signature_data",JSON.stringify(e)),i&&i(),c(""),d(""),m([""]),p(""),x(!1),g.current&&g.current.clear(),s()}catch(t){}},className:"space-y-5",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900",children:"Confirmação dos Dados"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-800 mb-1",children:"Nome"}),e.jsx("input",{type:"text",value:l,onChange:e=>c(e.target.value),placeholder:"Digite seu nome",className:"w-full p-2.5 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent text-gray-900 placeholder-gray-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-800 mb-1",children:"Telefone"}),e.jsx("input",{type:"tel",value:o,onChange:e=>d(e.target.value),placeholder:"Digite seu telefone",className:"w-full p-2.5 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent text-gray-900 placeholder-gray-500"})]}),u.map(((t,s)=>e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-800 mb-1",children:"E-mail"}),e.jsx("input",{type:"email",value:t,onChange:e=>((e,t)=>{const s=[...u];s[e]=t,m(s)})(s,e.target.value),placeholder:"Digite seu e-mail",className:"w-full p-2.5 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent text-gray-900 placeholder-gray-500"})]})},s))),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-800",children:"Assinatura"}),e.jsx("button",{type:"button",onClick:()=>x(!v),className:`px-4 py-2 ${v?"bg-red-600 hover:bg-red-700":"bg-green-600 hover:bg-green-700"} text-white text-sm rounded-md transition-colors font-medium`,children:v?"Habilitar Escrita":"Desabilitar Escrita"})]}),e.jsx("div",{className:"border border-gray-300 rounded-md bg-white",children:e.jsx($,{ref:g,disabled:v,onSignatureChange:p})}),e.jsx("button",{type:"button",onClick:()=>{g.current?.clear()},className:"mt-2 px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 transition-colors font-medium",children:"Limpar Assinatura"})]}),e.jsx("div",{className:"flex justify-end mt-8",children:e.jsx("button",{type:"submit",className:"px-6 py-2.5 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors disabled:bg-gray-400 disabled:cursor-not-allowed font-medium text-base",disabled:!(l&&o&&h&&u[0]),children:"Salvar"})})]})]})}):null},Q=e=>{localStorage.setItem(A.DEVICES,JSON.stringify(e))},X=e=>{localStorage.setItem(A.SERVICE_ORDERS,JSON.stringify(e))},K={selectedDevice:"",selectedStatus:"",quantity:"",devices:[],savedDevices:[],isLoading:!1,startTime:null,endTime:null,selectedProduct:null,serviceOrders:[],observations:"",location:"",selectedOs:null,counter:0,currentPage:"home"};function W(e,t){switch(t.type){case"SET_DEVICE":return{...e,selectedDevice:t.payload};case"SET_STATUS":return{...e,selectedStatus:t.payload};case"SET_QUANTITY":return{...e,quantity:t.payload};case"SET_DEVICES":return{...e,devices:t.payload};case"UPDATE_DEVICE":return{...e,devices:e.devices.map((e=>e.id===t.payload.id?{...e,status:t.payload.status}:e))};case"SET_LOADING":return{...e,isLoading:t.payload};case"SAVE_DEVICES":return{...e,savedDevices:[...e.savedDevices,...e.devices]};case"CLEAR_CURRENT":return{...e,selectedDevice:"",selectedStatus:"",quantity:"",devices:[]};case"RESET":return{...e,selectedDevice:"",selectedStatus:"",quantity:"",devices:[],savedDevices:[],isLoading:!1};case"SET_PAGE":return{...e,currentPage:t.payload};case"SET_SELECTED_PRODUCT":return{...e,selectedProduct:t.payload};case"ADD_SERVICE_ORDER":return{...e,serviceOrders:[...e.serviceOrders,{id:e.serviceOrders.length+1,createdAt:new Date,deviceCount:t.payload.devices.length,status:"Concluída",devices:t.payload.devices,pdfUrl:t.payload.pdfUrl,client:t.payload.client,service:t.payload.service,product:t.payload.product,observations:t.payload.observations,startTime:t.payload.startTime,endTime:t.payload.endTime,signatures:t.payload.signatures}],savedDevices:[],devices:[],selectedDevice:"",selectedStatus:"",quantity:"",currentPage:"stats"};case"SET_START_TIME":return{...e,startTime:t.payload,isLoading:!1};case"SET_END_TIME":return{...e,endTime:t.payload,isLoading:!1};default:return e}}function Z(){const[t,s]=a.useState("schedule"),[n,r]=a.useReducer(W,K),[i,l]=a.useState(""),[o,d]=a.useState(""),[u,m]=a.useState(""),[h,p]=a.useState(!1),[v,y]=a.useState("");a.useState("ml");const[f,b]=a.useState(""),[j,N]=a.useState("");a.useRef(null);const{showNotification:S}=J(),[w,E]=a.useState(!1);a.useEffect((()=>{Q(n.devices)}),[n.devices]),a.useEffect((()=>{X(n.serviceOrders)}),[n.serviceOrders]),a.useEffect((()=>{const e=localStorage.getItem("serviceStartTime");e&&r({type:"SET_START_TIME",payload:new Date(e)});const t=e=>{const{startTime:t}=e.detail;r({type:"SET_START_TIME",payload:new Date(t)})};return window.addEventListener("serviceStart",t),()=>{window.removeEventListener("serviceStart",t)}}),[]),a.useEffect((()=>{const e=localStorage.getItem("serviceOrders");if(e){const t=JSON.parse(e).find((e=>"in_progress"===e.status));t&&r({type:"SET_START_TIME",payload:new Date(t.createdAt)})}const t=e=>{const{startTime:t}=e.detail;r({type:"SET_START_TIME",payload:new Date(t)})};return window.addEventListener("serviceOrderStarted",t),()=>{window.removeEventListener("serviceOrderStarted",t)}}),[]);const T=a.useCallback((e=>{try{const t=parseInt(e);if(isNaN(t))return r({type:"SET_QUANTITY",payload:""}),void r({type:"SET_DEVICES",payload:[]});if(t>2e3)return;if(t<0)return;if(r({type:"SET_QUANTITY",payload:e}),n.selectedDevice&&e){const e=Array.from({length:t},((e,t)=>({id:n.counter+t+1,type:n.selectedDevice,number:n.counter+t+1})));r({type:"SET_DEVICES",payload:e})}else r({type:"SET_DEVICES",payload:[]})}catch(t){}}),[n.selectedDevice,n.counter]),A=a.useCallback((e=>{const t=n.devices.find((t=>t.id===e));if(t){const s=t.status?null:n.selectedStatus||"Conforme";r({type:"UPDATE_DEVICE",payload:{id:e,status:s}})}}),[n.devices,n.selectedStatus]),k=a.useCallback((()=>{if("Conforme"===n.selectedStatus){const e=n.devices.map((e=>({...e,status:e.status?e.status:"Conforme"})));r({type:"SET_DEVICES",payload:e})}}),[n.selectedStatus,n.devices]),R=a.useCallback((()=>{0!==n.devices.length&&n.devices.every((e=>e.status))&&(r({type:"SAVE_DEVICES"}),r({type:"CLEAR_CURRENT"}))}),[n.devices]),L=["pulverizacao","atomizacao","termonebulizacao","polvilhamento","iscagem_gel"].includes(i),z=a.useCallback((()=>!(!i||!j)&&(!(L&&!n.selectedProduct)&&("monitoramento"!==i||0!==n.savedDevices.length))),[i,j,L,n.selectedProduct,n.savedDevices.length]),q=a.useCallback((async()=>{if(!n.startTime)return;r({type:"SET_END_TIME",payload:new Date});try{r({type:"SET_LOADING",payload:!0});const t=new Date,a=t.toLocaleDateString("pt-BR"),c=t.toLocaleTimeString("pt-BR"),h=localStorage.getItem("selectedClient"),p=h?JSON.parse(h):null,x=n.savedDevices.reduce(((e,t)=>{e[t.type]||(e[t.type]={type:t.type,quantity:0,status:[],list:[]}),e[t.type].quantity++,e[t.type].list.push(t.number.toString());return(t.status?[t.status]:["N/A"]).forEach((s=>{const a=e[t.type].status.find((e=>e.name===s));a?(a.count++,a.devices.push(t.number)):e[t.type].status.push({name:s,count:1,devices:[t.number]})})),e}),{}),g=Object.values(x),f={orderNumber:`${n.serviceOrders.length+1}`,date:a,startTime:n.startTime?.toLocaleTimeString("pt-BR")||c,endTime:n.endTime?.toLocaleTimeString("pt-BR")||c,client:p||{code:"N/A",branch:"Cliente não selecionado",name:"Cliente não selecionado",document:"N/A",address:"N/A",contact:"N/A",phone:"N/A"},service:{type:i,target:j,location:o||"N/A"},product:n.selectedProduct?{name:n.selectedProduct.name,activeIngredient:n.selectedProduct.activeIngredient,chemicalGroup:n.selectedProduct.chemicalGroup,registration:n.selectedProduct.registration,batch:n.selectedProduct.batch,validity:n.selectedProduct.validity,quantity:v?`${v} ${n.selectedProduct.quantity}`:"N/A",dilution:n.selectedProduct.dilution}:null,devices:g,observations:u||"",signatures:{serviceResponsible:"Técnico Responsável",technicalResponsible:"Responsável Técnico",clientRepresentative:"Representante do Cliente"}};try{const e=await I(f),t=window.URL.createObjectURL(e);r({type:"ADD_SERVICE_ORDER",payload:{devices:n.savedDevices,pdfUrl:t,client:f.client,service:f.service,product:f.product,observations:u||"",startTime:c,endTime:c,signatures:f.signatures}});const a=document.createElement("a");a.href=t,a.download=`ordem-servico-${f.orderNumber}.pdf`,document.body.appendChild(a),a.click(),document.body.removeChild(a),l(""),N(""),b(""),d(""),m(""),y(""),r({type:"SET_SELECTED_PRODUCT",payload:null}),r({type:"CLEAR_CURRENT"}),localStorage.removeItem("serviceStartTime"),S("Ordem de serviço finalizada com sucesso!","success");const i=localStorage.getItem("safeprag_service_orders");if(i){const e=JSON.parse(i).find((e=>"in_progress"===e.status));if(e){const t=new CustomEvent("serviceOrderFinished",{detail:{success:!0}});window.dispatchEvent(t);const s=new CustomEvent("scheduleUpdate",{detail:{scheduleId:e.scheduleId,status:"completed"}});window.dispatchEvent(s),O(e.scheduleId,"completed")}}s("schedule")}catch(e){S("Erro ao gerar o PDF. Verifique os dados e tente novamente.","error")}}catch(t){S("Erro ao finalizar ordem de serviço. Tente novamente.","error")}finally{r({type:"SET_LOADING",payload:!1})}}),[z,n.serviceOrders.length,i,j,o,v,n.selectedProduct,u,n.savedDevices,r,s]);a.useEffect((()=>{Q(n.devices)}),[n.devices]),a.useEffect((()=>{X(n.serviceOrders)}),[n.serviceOrders]),a.useCallback((e=>{r({type:"SET_PAGE",payload:e})}),[]),a.useCallback((()=>"tratamento"===i),[i]),a.useCallback((()=>!!L||!n.isLoading&&n.devices.length>0),[L,n.isLoading,n.devices.length]),a.useCallback((async e=>{try{r({type:"SET_LOADING",payload:!0});const t=n.savedDevices,s=await I({devices:t,client:{code:e.clientCode,name:e.clientName,document:"N/A",address:"N/A",contact:"N/A",phone:"N/A",branch:"N/A"},service:{type:i,target:j,location:o},product:{name:n.selectedProduct?.name||"N/A",activeIngredient:n.selectedProduct?.activeIngredient||"N/A",chemicalGroup:n.selectedProduct?.chemicalGroup||"N/A",registration:n.selectedProduct?.registration||"N/A",batch:n.selectedProduct?.batch||"N/A",validity:n.selectedProduct?.validity||"N/A",quantity:`${v} ${n.selectedProduct?.quantity}`,dilution:n.selectedProduct?.dilution||"N/A"},observations:u,startTime:e.time,endTime:e.endTime,signatures:e.signatures});r({type:"ADD_SERVICE_ORDER",payload:{devices:t,pdfUrl:s,client:{code:e.clientCode,name:e.clientName,document:"N/A",address:"N/A",contact:"N/A",phone:"N/A",branch:"N/A"},service:{type:i,target:j,location:o},product:{name:n.selectedProduct?.name||"N/A",activeIngredient:n.selectedProduct?.activeIngredient||"N/A",chemicalGroup:n.selectedProduct?.chemicalGroup||"N/A",registration:n.selectedProduct?.registration||"N/A",batch:n.selectedProduct?.batch||"N/A",validity:n.selectedProduct?.validity||"N/A",quantity:`${v} ${n.selectedProduct?.quantity}`,dilution:n.selectedProduct?.dilution||"N/A"},observations:u,startTime:e.time,endTime:e.endTime,signatures:e.signatures}}),S("Ordem de serviço gerada e baixada com sucesso!","success")}catch(t){S("Erro ao gerar ordem de serviço. Tente novamente.","error")}finally{r({type:"SET_LOADING",payload:!1})}}),[n.savedDevices,i,j,o,v,n.selectedProduct,u,r]);const M=[{id:"schedule",label:"Agenda",icon:c},{id:"activity",label:"Atividade",icon:x},{id:"settings",label:"Admin",icon:g}],U=e=>{if(s(e),"activity"===e){const e=localStorage.getItem("serviceStartTime");e&&r({type:"SET_START_TIME",payload:new Date(e)})}};return e.jsxs(F,{children:[e.jsxs("div",{className:"flex flex-col h-screen bg-gray-100",children:["schedule"===t&&e.jsx(C,{onTabChange:U,onOSStart:()=>U("activity")}),"activity"===t&&e.jsx(P,{serviceType:i,targetPest:j,location:o,observations:u,applicationMethod:f,productAmount:v,state:n,startTime:n.startTime,endTime:n.endTime,isLoading:n.isLoading,showDeviceModal:h,onServiceTypeChange:e=>{const t=e.target.value;l(t),"tratamento"!==t&&b("")},onTargetPestChange:N,onLocationChange:d,onApplicationMethodChange:b,onProductAmountChange:y,onObservationsChange:m,onOpenDeviceModal:()=>{p(!0)},onCloseDeviceModal:()=>p(!1),onFinishOS:q,onApproveOS:()=>E(!0),onProductSelect:e=>{r({type:"SET_SELECTED_PRODUCT",payload:{name:e.name,activeIngredient:e.activeIngredient,chemicalGroup:e.chemicalGroup,registration:e.registration,batch:e.batch,validity:e.expirationDate,quantity:e.measure,dilution:e.diluent}})},onDeviceChange:e=>{r({type:"SET_DEVICE",payload:e})},onStatusChange:e=>{r({type:"SET_STATUS",payload:e})},onQuantityChange:T,onDeviceClick:A,onSelectAll:k,onSaveDevices:R,canFinishOS:z,canSave:L||!n.isLoading&&n.devices.length>0}),"settings"===t&&e.jsx(D,{})]}),e.jsx(H,{}),e.jsx(_,{activeTab:t,onTabChange:U,items:M}),e.jsx(Y,{isOpen:w,onClose:()=>E(!1),onConfirm:e=>{const t=(()=>{const e=localStorage.getItem("serviceOrders");if(e)return JSON.parse(e).find((e=>"in_progress"===e.status));return null})();t&&((e=>{const t=localStorage.getItem("serviceOrders");if(t){const s=JSON.parse(t).map((t=>t.id===e?{...t,status:"approved"}:t));localStorage.setItem("serviceOrders",JSON.stringify(s))}})(t.id),S("Ordem de serviço aprovada com sucesso!","success"),s("schedule"),E(!1))}})]})}const ee=y([{path:"/",element:e.jsx(Z,{})},{path:"/",element:e.jsx(k,{}),children:[{path:"agendamentos",element:e.jsx(U,{})},{path:"ordens",element:e.jsx("div",{children:"Em desenvolvimento"})},{path:"configuracoes",element:e.jsx("div",{children:"Em desenvolvimento"})}]}]),te=a.createContext({});function se({children:t}){const[s,n]=a.useState([]),[i,l]=a.useState({}),[c,o]=a.useState(!1),d=a.useCallback((async()=>{try{o(!0);const e=await q.getSchedules(i);n(e)}catch(e){r.error("Erro ao carregar agendamentos")}finally{o(!1)}}),[i]),u=a.useCallback((async(e,t)=>{try{await q.updateScheduleStatus(e,t),await d()}catch(s){throw r.error("Erro ao atualizar status do agendamento"),s}}),[d]);return e.jsx(te.Provider,{value:{clients:s,filters:i,loading:c,setFilters:l,loadSchedules:d,updateScheduleStatus:u},children:t})}f.createRoot(document.getElementById("root")).render(e.jsx(b.StrictMode,{children:e.jsx(G,{children:e.jsx(F,{children:e.jsxs(se,{children:[e.jsx(j,{router:ee}),e.jsx(N,{position:"top-right",autoClose:3e3,hideProgressBar:!1,newestOnTop:!0,closeOnClick:!0,rtl:!1,pauseOnFocusLoss:!0,draggable:!0,pauseOnHover:!0,theme:"light"})]})})})}));
